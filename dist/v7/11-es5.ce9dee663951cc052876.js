!function(){function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&n(e,t)}function n(e,t){return(n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function o(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,o=c(e);if(t){var s=c(this).constructor;n=Reflect.construct(o,arguments,s)}else n=o.apply(this,arguments);return a(this,n)}}function a(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{dnpt:function(n,a,c){"use strict";c.r(a),c.d(a,"RecipesModule",function(){return z});var s,r,l,i,b,d,p,h,u,m,I,J=c("ofXK"),g=c("tyNb"),f=c("PCNd"),y=c("Ydvz"),w=c("fXoL"),v=c("zg9e"),k=c("FKbk"),C=c("xE8d"),S=((s=function(n){t(c,n);var a=o(c);function c(){return e(this,c),a.apply(this,arguments)}return c}(y.a)).\u0275fac=function(e){return P(e||s)},s.\u0275cmp=w.Ab({type:s,selectors:[["app-cqrs"]],features:[w.ub],decls:329,vars:64,consts:[[1,"content"],["contentReference",""],[1,"github-links"],["href","https://github.com/nestjs/docs.nestjs.com/edit/master/content/recipes/cqrs.md","aria-label","Suggest Edits","title","Suggest Edits"],[1,"fas","fa-edit"],["id","cqrs"],["rel","nofollow","target","_blank","href","https://en.wikipedia.org/wiki/Create,_read,_update_and_delete"],["rel","nofollow","target","_blank","href","https://github.com/nestjs/cqrs"],["appAnchor","","id","installation"],[1,"language-bash"],["appAnchor","","id","commands"],[1,"filename"],["app1d15c70db715c6e02dd25c42a04a3e224c15e0ec",""],[1,"language-typescript"],["app0983b29af8245145db03961b471c5c9fc4aacf55",""],["appa6181275af9cfc051d8ac0bf0f69c8f438562255",""],["appAnchor","","id","events"],["appd361e3be741ad06e1a431f2c708d8e224e3d6751",""],["appd2912c53bd550873322e98206b56d09ad07a0040",""],["appd5df1957c529814dfbe00af71603b577ee133332",""],[1,"info"],["appb89db54bc80b6b467b6be0f2a49c55f981757b53",""],["appAnchor","","id","sagas"],["rel","nofollow","target","_blank","href","https://github.com/ReactiveX/rxjs"],["appf71c82f53efac4098f1896cedc045cf86b9bb92c",""],["appAnchor","","id","queries"],["appAnchor","","id","setup"],["app8dce8c7f95745782863b3ec51d53d4dc8f2afd3a",""],["appAnchor","","id","summary"],["appAnchor","","id","example"],["rel","nofollow","target","_blank","href","https://github.com/kamilmysliwiec/nest-cqrs-example"]],template:function(e,t){if(1&e&&(w.Jb(0,"div",0,1),w.Jb(2,"div",2),w.Jb(3,"a",3),w.Hb(4,"i",4),w.Ib(),w.Ib(),w.Jb(5,"h3",5),w.lc(6,"CQRS"),w.Ib(),w.Jb(7,"p"),w.lc(8,"The flow of simple "),w.Jb(9,"a",6),w.lc(10,"CRUD"),w.Ib(),w.lc(11," (Create, Read, Update and Delete) applications can be described using the following steps:"),w.Ib(),w.Jb(12,"ol"),w.Jb(13,"li"),w.lc(14,"The "),w.Jb(15,"strong"),w.lc(16,"controllers"),w.Ib(),w.lc(17," layer handles HTTP requests and delegates tasks to the services layer."),w.Ib(),w.Jb(18,"li"),w.lc(19,"The "),w.Jb(20,"strong"),w.lc(21,"services layer"),w.Ib(),w.lc(22," is where most of the business logic lives."),w.Ib(),w.Jb(23,"li"),w.lc(24,"Services use "),w.Jb(25,"strong"),w.lc(26,"repositories / DAOs"),w.Ib(),w.lc(27," to change / persist entities."),w.Ib(),w.Jb(28,"li"),w.lc(29,"Entities act as containers for the values, with setters and getters."),w.Ib(),w.Ib(),w.Jb(30,"p"),w.lc(31,"In most cases, for small and medium-sized applications, this pattern is sufficient. However, when our requirements become more complex, the "),w.Jb(32,"strong"),w.lc(33,"CQRS"),w.Ib(),w.lc(34," model may be more appropriate and scalable. To facilitate that model, Nest provides a lightweight "),w.Jb(35,"a",7),w.lc(36,"CQRS module"),w.Ib(),w.lc(37,". This chapter describes how to use it."),w.Ib(),w.Jb(38,"h4",8),w.Jb(39,"span"),w.lc(40,"Installation"),w.Ib(),w.Ib(),w.Jb(41,"p"),w.lc(42,"First install the required package:"),w.Ib(),w.Jb(43,"pre"),w.Jb(44,"code",9),w.lc(45,"\n$ npm install --save @nestjs/cqrs\n"),w.Ib(),w.Ib(),w.Jb(46,"h4",10),w.Jb(47,"span"),w.lc(48,"Commands"),w.Ib(),w.Ib(),w.Jb(49,"p"),w.lc(50,"In this model, each action is called a "),w.Jb(51,"strong"),w.lc(52,"Command"),w.Ib(),w.lc(53,". When a command is dispatched, the application reacts to it. Commands can be dispatched from the services layer, or directly from controllers/gateways. Commands are consumed by "),w.Jb(54,"strong"),w.lc(55,"Command Handlers"),w.Ib(),w.lc(56,"."),w.Ib(),w.Jb(57,"span",11),w.lc(58),w.Vb(59,"extension"),w.Hb(60,"app-tabs",null,12),w.Ib(),w.Jb(62,"pre"),w.Jb(63,"code",13),w.lc(64,"\n@Injectable()\nexport class HeroesGameService {\n  constructor(private commandBus: CommandBus) {}\n\n  async killDragon(heroId: string, killDragonDto: KillDragonDto) {\n    return this.commandBus.execute(\n      new KillDragonCommand(heroId, killDragonDto.dragonId)\n    );\n  }\n}\n"),w.Ib(),w.Ib(),w.Jb(65,"pre"),w.Jb(66,"code",13),w.lc(67,"\n@Injectable()\n@Dependencies(CommandBus)\nexport class HeroesGameService {\n  constructor(commandBus) {\n    this.commandBus = commandBus;\n  }\n\n  async killDragon(heroId, killDragonDto) {\n    return this.commandBus.execute(\n      new KillDragonCommand(heroId, killDragonDto.dragonId)\n    );\n  }\n}\n"),w.Ib(),w.Ib(),w.Jb(68,"p"),w.lc(69,"Here's a sample service that dispatches "),w.Jb(70,"code"),w.lc(71,"KillDragonCommand"),w.Ib(),w.lc(72,". Let's see how the command looks:"),w.Ib(),w.Jb(73,"span",11),w.lc(74),w.Vb(75,"extension"),w.Hb(76,"app-tabs",null,14),w.Ib(),w.Jb(78,"pre"),w.Jb(79,"code",13),w.lc(80,"\nexport class KillDragonCommand {\n  constructor(\n    public readonly heroId: string,\n    public readonly dragonId: string,\n  ) {}\n}\n"),w.Ib(),w.Ib(),w.Jb(81,"pre"),w.Jb(82,"code",13),w.lc(83,"\nexport class KillDragonCommand {\n  constructor(heroId, dragonId) {\n    this.heroId = heroId;\n    this.dragonId = dragonId;\n  }\n}\n"),w.Ib(),w.Ib(),w.Jb(84,"p"),w.lc(85,"The "),w.Jb(86,"code"),w.lc(87,"CommandBus"),w.Ib(),w.lc(88," is a "),w.Jb(89,"strong"),w.lc(90,"stream"),w.Ib(),w.lc(91," of commands. It delegates commands to the equivalent handlers. Each command must have a corresponding "),w.Jb(92,"strong"),w.lc(93,"Command Handler"),w.Ib(),w.lc(94,":"),w.Ib(),w.Jb(95,"span",11),w.lc(96),w.Vb(97,"extension"),w.Hb(98,"app-tabs",null,15),w.Ib(),w.Jb(100,"pre"),w.Jb(101,"code",13),w.lc(102,"\n@CommandHandler(KillDragonCommand)\nexport class KillDragonHandler implements ICommandHandler<KillDragonCommand> {\n  constructor(private repository: HeroRepository) {}\n\n  async execute(command: KillDragonCommand) {\n    const { heroId, dragonId } = command;\n    const hero = this.repository.findOneById(+heroId);\n\n    hero.killEnemy(dragonId);\n    await this.repository.persist(hero);\n  }\n}\n"),w.Ib(),w.Ib(),w.Jb(103,"pre"),w.Jb(104,"code",13),w.lc(105,"\n@CommandHandler(KillDragonCommand)\n@Dependencies(HeroRepository)\nexport class KillDragonHandler {\n  constructor(repository) {\n    this.repository = repository;\n  }\n\n  async execute(command) {\n    const { heroId, dragonId } = command;\n    const hero = this.repository.findOneById(+heroId);\n\n    hero.killEnemy(dragonId);\n    await this.repository.persist(hero);\n  }\n}\n"),w.Ib(),w.Ib(),w.Jb(106,"p"),w.lc(107,"With this approach, every application state change is driven by the occurrence of a "),w.Jb(108,"strong"),w.lc(109,"Command"),w.Ib(),w.lc(110,". The logic is encapsulated in handlers. With this approach, we can simply add behavior like logging or persisting commands in the database (e.g., for diagnostics purposes)."),w.Ib(),w.Jb(111,"h4",16),w.Jb(112,"span"),w.lc(113,"Events"),w.Ib(),w.Ib(),w.Jb(114,"p"),w.lc(115,"Command handlers neatly encapsulate logic. While beneficial, the application structure is still not flexible enough, not "),w.Jb(116,"strong"),w.lc(117,"reactive"),w.Ib(),w.lc(118,". To remedy this, we also introduce "),w.Jb(119,"strong"),w.lc(120,"events"),w.Ib(),w.lc(121,"."),w.Ib(),w.Jb(122,"span",11),w.lc(123),w.Vb(124,"extension"),w.Hb(125,"app-tabs",null,17),w.Ib(),w.Jb(127,"pre"),w.Jb(128,"code",13),w.lc(129,"\nexport class HeroKilledDragonEvent {\n  constructor(\n    public readonly heroId: string,\n    public readonly dragonId: string,\n  ) {}\n}\n"),w.Ib(),w.Ib(),w.Jb(130,"pre"),w.Jb(131,"code",13),w.lc(132,"\nexport class HeroKilledDragonEvent {\n  constructor(heroId, dragonId) {\n    this.heroId = heroId;\n    this.dragonId = dragonId;\n  }\n}\n"),w.Ib(),w.Ib(),w.Jb(133,"p"),w.lc(134,"Events are asynchronous. They are dispatched either by "),w.Jb(135,"strong"),w.lc(136,"models"),w.Ib(),w.lc(137," or directly using "),w.Jb(138,"code"),w.lc(139,"EventBus"),w.Ib(),w.lc(140,". In order to dispatch events, models have to extend the "),w.Jb(141,"code"),w.lc(142,"AggregateRoot"),w.Ib(),w.lc(143," class."),w.Ib(),w.Jb(144,"span",11),w.lc(145),w.Vb(146,"extension"),w.Hb(147,"app-tabs",null,18),w.Ib(),w.Jb(149,"pre"),w.Jb(150,"code",13),w.lc(151,"\nexport class Hero extends AggregateRoot {\n  constructor(private id: string) {\n    super();\n  }\n\n  killEnemy(enemyId: string) {\n    // logic\n    this.apply(new HeroKilledDragonEvent(this.id, enemyId));\n  }\n}\n"),w.Ib(),w.Ib(),w.Jb(152,"pre"),w.Jb(153,"code",13),w.lc(154,"\nexport class Hero extends AggregateRoot {\n  constructor(id) {\n    super();\n    this.id = id;\n  }\n\n  killEnemy(enemyId) {\n    // logic\n    this.apply(new HeroKilledDragonEvent(this.id, enemyId));\n  }\n}\n"),w.Ib(),w.Ib(),w.Jb(155,"p"),w.lc(156,"The "),w.Jb(157,"code"),w.lc(158,"apply()"),w.Ib(),w.lc(159," method does not dispatch events yet because there's no relationship between the model and the "),w.Jb(160,"code"),w.lc(161,"EventPublisher"),w.Ib(),w.lc(162," class. How do we associate the model and the publisher? By using a publisher "),w.Jb(163,"code"),w.lc(164,"mergeObjectContext()"),w.Ib(),w.lc(165," method inside our command handler."),w.Ib(),w.Jb(166,"span",11),w.lc(167),w.Vb(168,"extension"),w.Hb(169,"app-tabs",null,19),w.Ib(),w.Jb(171,"pre"),w.Jb(172,"code",13),w.lc(173,"\n@CommandHandler(KillDragonCommand)\nexport class KillDragonHandler implements ICommandHandler<KillDragonCommand> {\n  constructor(\n    private repository: HeroRepository,\n    private publisher: EventPublisher,\n  ) {}\n\n  async execute(command: KillDragonCommand) {\n    const { heroId, dragonId } = command;\n    const hero = this.publisher.mergeObjectContext(\n      await this.repository.findOneById(+heroId),\n    );\n    hero.killEnemy(dragonId);\n    hero.commit();\n  }\n}\n"),w.Ib(),w.Ib(),w.Jb(174,"pre"),w.Jb(175,"code",13),w.lc(176,"\n@CommandHandler(KillDragonCommand)\n@Dependencies(HeroRepository, EventPublisher)\nexport class KillDragonHandler {\n  constructor(repository, publisher) {\n    this.repository = repository;\n    this.publisher = publisher;\n  }\n\n  async execute(command) {\n    const { heroId, dragonId } = command;\n    const hero = this.publisher.mergeObjectContext(\n      await this.repository.findOneById(+heroId),\n    );\n    hero.killEnemy(dragonId);\n    hero.commit();\n  }\n}\n"),w.Ib(),w.Ib(),w.Jb(177,"p"),w.lc(178,"Now everything works as expected. Notice that we need to "),w.Jb(179,"code"),w.lc(180,"commit()"),w.Ib(),w.lc(181," events since they're not being dispatched immediately. Obviously, an object doesn't have to exist up front. We can easily merge type context as well:"),w.Ib(),w.Jb(182,"pre"),w.Jb(183,"code",13),w.lc(184,"\nconst HeroModel = this.publisher.mergeClassContext(Hero);\nnew HeroModel('id');\n"),w.Ib(),w.Ib(),w.Jb(185,"p"),w.lc(186,"Now the model has the ability to publish events. Additionally, we can emit events manually using "),w.Jb(187,"code"),w.lc(188,"EventBus"),w.Ib(),w.lc(189,":"),w.Ib(),w.Jb(190,"pre"),w.Jb(191,"code",13),w.lc(192,"\nthis.eventBus.publish(new HeroKilledDragonEvent());\n"),w.Ib(),w.Ib(),w.Jb(193,"blockquote",20),w.Jb(194,"strong"),w.lc(195,"Hint"),w.Ib(),w.lc(196," The "),w.Jb(197,"code"),w.lc(198,"EventBus"),w.Ib(),w.lc(199," is an injectable class.\n"),w.Ib(),w.Jb(200,"p"),w.lc(201,"Each event can have multiple "),w.Jb(202,"strong"),w.lc(203,"Event Handlers"),w.Ib(),w.lc(204,"."),w.Ib(),w.Jb(205,"span",11),w.lc(206),w.Vb(207,"extension"),w.Hb(208,"app-tabs",null,21),w.Ib(),w.Jb(210,"pre"),w.Jb(211,"code",13),w.lc(212,"\n@EventsHandler(HeroKilledDragonEvent)\nexport class HeroKilledDragonHandler implements IEventHandler<HeroKilledDragonEvent> {\n  constructor(private repository: HeroRepository) {}\n\n  handle(event: HeroKilledDragonEvent) {\n    // logic\n  }\n}\n"),w.Ib(),w.Ib(),w.Jb(213,"p"),w.lc(214,"Now we can move the "),w.Jb(215,"strong"),w.lc(216,"write logic"),w.Ib(),w.lc(217," into the event handlers."),w.Ib(),w.Jb(218,"h4",22),w.Jb(219,"span"),w.lc(220,"Sagas"),w.Ib(),w.Ib(),w.Jb(221,"p"),w.lc(222,"This type of "),w.Jb(223,"strong"),w.lc(224,"Event-Driven Architecture"),w.Ib(),w.lc(225," improves application "),w.Jb(226,"strong"),w.lc(227,"reactiveness and scalability"),w.Ib(),w.lc(228,". Now, when we have events, we can simply react to them in various ways. "),w.Jb(229,"strong"),w.lc(230,"Sagas"),w.Ib(),w.lc(231," are the final building block from an architectural point of view."),w.Ib(),w.Jb(232,"p"),w.lc(233,"Sagas are an extremely powerful feature. A single saga may listen for 1..* events. Using the "),w.Jb(234,"a",23),w.lc(235,"RxJS"),w.Ib(),w.lc(236," library, it can combine, merge, filter or apply other "),w.Jb(237,"code"),w.lc(238,"RxJS"),w.Ib(),w.lc(239," operators on the event stream. Each saga returns an Observable which contains a command. This command is dispatched "),w.Jb(240,"strong"),w.lc(241,"asynchronously"),w.Ib(),w.lc(242,"."),w.Ib(),w.Jb(243,"span",11),w.lc(244),w.Vb(245,"extension"),w.Hb(246,"app-tabs",null,24),w.Ib(),w.Jb(248,"pre"),w.Jb(249,"code",13),w.lc(250,"\n@Injectable()\nexport class HeroesGameSagas {\n  @Saga()\n  dragonKilled = (events$: Observable<any>): Observable<ICommand> => {\n    return events$.pipe(\n      ofType(HeroKilledDragonEvent),\n      map((event) => new DropAncientItemCommand(event.heroId, fakeItemID)),\n    );\n  }\n}\n"),w.Ib(),w.Ib(),w.Jb(251,"pre"),w.Jb(252,"code",13),w.lc(253,"\n@Injectable()\nexport class HeroesGameSagas {\n  @Saga()\n  dragonKilled = (events$) => {\n    return events$.pipe(\n      ofType(HeroKilledDragonEvent),\n      map((event) => new DropAncientItemCommand(event.heroId, fakeItemID)),\n    );\n  }\n}\n"),w.Ib(),w.Ib(),w.Jb(254,"blockquote",20),w.Jb(255,"strong"),w.lc(256,"Hint"),w.Ib(),w.lc(257," The "),w.Jb(258,"code"),w.lc(259,"ofType"),w.Ib(),w.lc(260," operator is exported from the "),w.Jb(261,"code"),w.lc(262,"@nestjs/cqrs"),w.Ib(),w.lc(263," package.\n"),w.Ib(),w.Jb(264,"p"),w.lc(265,"We declared a rule - when any hero kills the dragon, the ancient item should be dropped. With this in place, "),w.Jb(266,"code"),w.lc(267,"DropAncientItemCommand"),w.Ib(),w.lc(268," will be dispatched and processed by the appropriate handler."),w.Ib(),w.Jb(269,"h4",25),w.Jb(270,"span"),w.lc(271,"Queries"),w.Ib(),w.Ib(),w.Jb(272,"p"),w.lc(273,"The "),w.Jb(274,"code"),w.lc(275,"CqrsModule"),w.Ib(),w.lc(276," can also be used for handling queries. The "),w.Jb(277,"code"),w.lc(278,"QueryBus"),w.Ib(),w.lc(279," follows the same pattern as the "),w.Jb(280,"code"),w.lc(281,"CommandsBus"),w.Ib(),w.lc(282,". Query handlers should implement the "),w.Jb(283,"code"),w.lc(284,"IQueryHandler"),w.Ib(),w.lc(285," interface and be marked with the "),w.Jb(286,"code"),w.lc(287,"@QueryHandler()"),w.Ib(),w.lc(288," decorator."),w.Ib(),w.Jb(289,"h4",26),w.Jb(290,"span"),w.lc(291,"Setup"),w.Ib(),w.Ib(),w.Jb(292,"p"),w.lc(293,"Finally, let's look at how to set up the whole CQRS mechanism."),w.Ib(),w.Jb(294,"span",11),w.lc(295),w.Vb(296,"extension"),w.Hb(297,"app-tabs",null,27),w.Ib(),w.Jb(299,"pre"),w.Jb(300,"code",13),w.lc(301,"\nexport const CommandHandlers = [KillDragonHandler, DropAncientItemHandler];\nexport const EventHandlers =  [HeroKilledDragonHandler, HeroFoundItemHandler];\n\n@Module({\n  imports: [CqrsModule],\n  controllers: [HeroesGameController],\n  providers: [\n    HeroesGameService,\n    HeroesGameSagas,\n    ...CommandHandlers,\n    ...EventHandlers,\n    HeroRepository,\n  ]\n})\nexport class HeroesGameModule {}\n"),w.Ib(),w.Ib(),w.Jb(302,"h4",28),w.Jb(303,"span"),w.lc(304,"Summary"),w.Ib(),w.Ib(),w.Jb(305,"p"),w.Jb(306,"code"),w.lc(307,"CommandBus"),w.Ib(),w.lc(308,", "),w.Jb(309,"code"),w.lc(310,"QueryBus"),w.Ib(),w.lc(311," and "),w.Jb(312,"code"),w.lc(313,"EventBus"),w.Ib(),w.lc(314," are "),w.Jb(315,"strong"),w.lc(316,"Observables"),w.Ib(),w.lc(317,". This means that you can easily subscribe to the whole stream and enrich your application with "),w.Jb(318,"strong"),w.lc(319,"Event Sourcing"),w.Ib(),w.lc(320,"."),w.Ib(),w.Jb(321,"h4",29),w.Jb(322,"span"),w.lc(323,"Example"),w.Ib(),w.Ib(),w.Jb(324,"p"),w.lc(325,"A working example is available "),w.Jb(326,"a",30),w.lc(327,"here"),w.Ib(),w.lc(328,"."),w.Ib(),w.Ib()),2&e){var n=w.ec(61),o=w.ec(77),a=w.ec(99),c=w.ec(126),s=w.ec(148),r=w.ec(170),l=w.ec(209),i=w.ec(247),b=w.ec(298);w.wb(58),w.nc(" ",w.Wb(59,37,"heroes-game.service",n.isJsActive),"\n"),w.wb(4),w.yb("hide",n.isJsActive),w.wb(3),w.yb("hide",!n.isJsActive),w.wb(9),w.nc(" ",w.Wb(75,40,"kill-dragon.command",o.isJsActive),"\n"),w.wb(4),w.yb("hide",o.isJsActive),w.wb(3),w.yb("hide",!o.isJsActive),w.wb(15),w.nc(" ",w.Wb(97,43,"kill-dragon.handler",a.isJsActive),"\n"),w.wb(4),w.yb("hide",a.isJsActive),w.wb(3),w.yb("hide",!a.isJsActive),w.wb(20),w.nc(" ",w.Wb(124,46,"hero-killed-dragon.event",c.isJsActive),"\n"),w.wb(4),w.yb("hide",c.isJsActive),w.wb(3),w.yb("hide",!c.isJsActive),w.wb(15),w.nc(" ",w.Wb(146,49,"hero.model",s.isJsActive),"\n"),w.wb(4),w.yb("hide",s.isJsActive),w.wb(3),w.yb("hide",!s.isJsActive),w.wb(15),w.nc(" ",w.Wb(168,52,"kill-dragon.handler",r.isJsActive),"\n"),w.wb(4),w.yb("hide",r.isJsActive),w.wb(3),w.yb("hide",!r.isJsActive),w.wb(32),w.nc(" ",w.Wb(207,55,"hero-killed-dragon.handler",l.isJsActive),"\n"),w.wb(38),w.nc(" ",w.Wb(245,58,"heroes-game.saga",i.isJsActive),"\n"),w.wb(4),w.yb("hide",i.isJsActive),w.wb(3),w.yb("hide",!i.isJsActive),w.wb(44),w.nc(" ",w.Wb(296,61,"heroes-game.module",b.isJsActive),"\n")}},directives:[v.a,k.a],pipes:[C.a],encapsulation:2,changeDetection:0}),s),P=w.Lb(S),A=((r=function(n){t(c,n);var a=o(c);function c(){return e(this,c),a.apply(this,arguments)}return c}(y.a)).\u0275fac=function(e){return T(e||r)},r.\u0275cmp=w.Ab({type:r,selectors:[["app-crud-generator"]],features:[w.ub],decls:128,vars:0,consts:[[1,"content"],["contentReference",""],[1,"github-links"],["href","https://github.com/nestjs/docs.nestjs.com/edit/master/content/recipes/crud-generator.md","aria-label","Suggest Edits","title","Suggest Edits"],[1,"fas","fa-edit"],["id","crud-generator"],["appAnchor","","id","introduction"],["routerLink","/cli/overview"],[1,"info"],["appAnchor","","id","generating-a-new-resource"],[1,"language-shell"],[1,"language-typescript"],[1,"warning"]],template:function(e,t){1&e&&(w.Jb(0,"div",0,1),w.Jb(2,"div",2),w.Jb(3,"a",3),w.Hb(4,"i",4),w.Ib(),w.Ib(),w.Jb(5,"h3",5),w.lc(6,"CRUD generator"),w.Ib(),w.Jb(7,"p"),w.lc(8,"Throughout the life span of a project, when we build new features, we often need to add new resources to our application. These resources typically require multiple, repetitive operations that we have to repeat each time we define a new resource."),w.Ib(),w.Jb(9,"h4",6),w.Jb(10,"span"),w.lc(11,"Introduction"),w.Ib(),w.Ib(),w.Jb(12,"p"),w.lc(13,"Let's imagine a real-world scenario, where we need to expose CRUD endpoints for 2 entities, let's say "),w.Jb(14,"strong"),w.lc(15,"User"),w.Ib(),w.lc(16," and "),w.Jb(17,"strong"),w.lc(18,"Product"),w.Ib(),w.lc(19," entities.\nFollowing the best practices, for each entity we would have to perform several operations, as follows:"),w.Ib(),w.Jb(20,"ul"),w.Jb(21,"li"),w.lc(22,"Generate a module ("),w.Jb(23,"code"),w.lc(24,"nest g mo"),w.Ib(),w.lc(25,") to keep code organized and establish clear boundaries (grouping related components)"),w.Ib(),w.Jb(26,"li"),w.lc(27,"Generate a controller ("),w.Jb(28,"code"),w.lc(29,"nest g co"),w.Ib(),w.lc(30,") to define CRUD routes (or queries/mutations for GraphQL applications)"),w.Ib(),w.Jb(31,"li"),w.lc(32,"Generate a service ("),w.Jb(33,"code"),w.lc(34,"nest g s"),w.Ib(),w.lc(35,") to implement & isolate business logic"),w.Ib(),w.Jb(36,"li"),w.lc(37,"Generate an entity class/interface to represent the resource data shape"),w.Ib(),w.Jb(38,"li"),w.lc(39,"Generate Data Transfer Objects (or inputs for GraphQL applications) to define how the data will be sent over the network"),w.Ib(),w.Ib(),w.Jb(40,"p"),w.lc(41,"That's a lot of steps!"),w.Ib(),w.Jb(42,"p"),w.lc(43,"To help speed up this repetitive process, "),w.Jb(44,"a",7),w.lc(45,"Nest CLI"),w.Ib(),w.lc(46," provides a generator (schematic) that automatically generates all the boilerplate code to help us avoid doing all of this, and make the developer experience much simpler."),w.Ib(),w.Jb(47,"blockquote",8),w.Jb(48,"strong"),w.lc(49,"Note"),w.Ib(),w.lc(50," The schematic supports generating "),w.Jb(51,"strong"),w.lc(52,"HTTP"),w.Ib(),w.lc(53," controllers, "),w.Jb(54,"strong"),w.lc(55,"Microservice"),w.Ib(),w.lc(56," controllers, "),w.Jb(57,"strong"),w.lc(58,"GraphQL"),w.Ib(),w.lc(59," resolvers (both code first and schema first), and "),w.Jb(60,"strong"),w.lc(61,"WebSocket"),w.Ib(),w.lc(62," Gateways.\n"),w.Ib(),w.Jb(63,"h4",9),w.Jb(64,"span"),w.lc(65,"Generating a new resource"),w.Ib(),w.Ib(),w.Jb(66,"p"),w.lc(67,"To create a new resource, simply run the following command in the root directory of your project:"),w.Ib(),w.Jb(68,"pre"),w.Jb(69,"code",10),w.lc(70,"\n$ nest g resource\n"),w.Ib(),w.Ib(),w.Jb(71,"p"),w.Jb(72,"code"),w.lc(73,"nest g resource"),w.Ib(),w.lc(74," command not only generates all the NestJS building blocks (module, service, controller classes) but also an entity class, DTO classes as well as the testing ("),w.Jb(75,"code"),w.lc(76,".spec"),w.Ib(),w.lc(77,") files."),w.Ib(),w.Jb(78,"p"),w.lc(79,"Below you can see the generated controller file (for REST API):"),w.Ib(),w.Jb(80,"pre"),w.Jb(81,"code",11),w.lc(82,"\n@Controller('users')\nexport class UsersController {\n  constructor(private readonly usersService: UsersService) {}\n\n  @Post()\n  create(@Body() createUserDto: CreateUserDto) {\n    return this.usersService.create(createUserDto);\n  }\n\n  @Get()\n  findAll() {\n    return this.usersService.findAll();\n  }\n\n  @Get(':id')\n  findOne(@Param('id') id: string) {\n    return this.usersService.findOne(+id);\n  }\n\n  @Put(':id')\n  update(@Param('id') id: string, @Body() updateUserDto: UpdateUserDto) {\n    return this.usersService.update(+id, updateUserDto);\n  }\n\n  @Delete(':id')\n  remove(@Param('id') id: string) {\n    return this.usersService.remove(+id);\n  }\n}\n"),w.Ib(),w.Ib(),w.Jb(83,"p"),w.lc(84,"Also, it automatically creates placeholders for all the CRUD endpoints (routes for REST APIs, queries and mutations for GraphQL, message subscribes for both Microservices and WebSocket Gateways) - all without having to lift a finger."),w.Ib(),w.Jb(85,"blockquote",12),w.Jb(86,"strong"),w.lc(87,"Note"),w.Ib(),w.lc(88," Generated service classes are "),w.Jb(89,"strong"),w.lc(90,"not"),w.Ib(),w.lc(91," tied to any specific "),w.Jb(92,"strong"),w.lc(93,"ORM (or data source)"),w.Ib(),w.lc(94,". This makes the generator generic enough to meet the needs of any project. By default, all methods will contain placeholders, allowing you to populate it with the data sources specific to your project.\n"),w.Ib(),w.Jb(95,"p"),w.lc(96,"Likewise, if you want to generate resolvers for a GraphQL application, simply select the "),w.Jb(97,"code"),w.lc(98,"GraphQL (code first)"),w.Ib(),w.lc(99," (or "),w.Jb(100,"code"),w.lc(101,"GraphQL (schema first)"),w.Ib(),w.lc(102,") as your transport layer."),w.Ib(),w.Jb(103,"p"),w.lc(104,"In this case, NestJS will generate a resolver class instead of a REST API controller:"),w.Ib(),w.Jb(105,"pre"),w.Jb(106,"code",10),w.lc(107,"\n$ nest g resource users\n\n> ? What transport layer do you use? GraphQL (code first)\n> ? Would you like to generate CRUD entry points? Yes\n> CREATE src/users/users.module.ts (224 bytes)\n> CREATE src/users/users.resolver.spec.ts (525 bytes)\n> CREATE src/users/users.resolver.ts (1109 bytes)\n> CREATE src/users/users.service.spec.ts (453 bytes)\n> CREATE src/users/users.service.ts (625 bytes)\n> CREATE src/users/dto/create-user.input.ts (195 bytes)\n> CREATE src/users/dto/update-user.input.ts (281 bytes)\n> CREATE src/users/entities/user.entity.ts (187 bytes)\n> UPDATE src/app.module.ts (312 bytes)\n"),w.Ib(),w.Ib(),w.Jb(108,"blockquote",8),w.Jb(109,"strong"),w.lc(110,"Hint"),w.Ib(),w.lc(111," To avoid generating test files, you can pass the "),w.Jb(112,"code"),w.lc(113,"--no-spec"),w.Ib(),w.lc(114," flag, as follows: "),w.Jb(115,"code"),w.lc(116,"nest g resource users --no-spec"),w.Ib(),w.Ib(),w.Jb(117,"p"),w.lc(118,"We can see below, that not only were all boilerplate mutations and queries created, but everything is all tied together. We're utilizing the "),w.Jb(119,"code"),w.lc(120,"UsersService"),w.Ib(),w.lc(121,", "),w.Jb(122,"code"),w.lc(123,"User"),w.Ib(),w.lc(124," Entity, and our DTO's."),w.Ib(),w.Jb(125,"pre"),w.Jb(126,"code",11),w.lc(127,"\nimport { Resolver, Query, Mutation, Args, Int } from '@nestjs/graphql';\nimport { UsersService } from './users.service';\nimport { User } from './entities/user.entity';\nimport { CreateUserInput } from './dto/create-user.input';\nimport { UpdateUserInput } from './dto/update-user.input';\n\n@Resolver(() => User)\nexport class UsersResolver {\n  constructor(private readonly usersService: UsersService) {}\n\n  @Mutation(() => User)\n  createUser(@Args('createUserInput') createUserInput: CreateUserInput) {\n    return this.usersService.create(createUserInput);\n  }\n\n  @Query(() => [User], { name: 'users' })\n  findAll() {\n    return this.usersService.findAll();\n  }\n\n  @Query(() => User, { name: 'user' })\n  findOne(@Args('id', { type: () => Int }) id: number) {\n    return this.usersService.findOne(id);\n  }\n\n  @Mutation(() => User)\n  updateUser(@Args('updateUserInput') updateUserInput: UpdateUserInput) {\n    return this.usersService.update(updateUserInput.id, updateUserInput);\n  }\n\n  @Mutation(() => User)\n  removeUser(@Args('id', { type: () => Int }) id: number) {\n    return this.usersService.remove(id);\n  }\n}\n"),w.Ib(),w.Ib(),w.Ib())},directives:[v.a,g.f],encapsulation:2,changeDetection:0}),r),T=w.Lb(A),x=((l=function(n){t(c,n);var a=o(c);function c(){return e(this,c),a.apply(this,arguments)}return c}(y.a)).\u0275fac=function(e){return H(e||l)},l.\u0275cmp=w.Ab({type:l,selectors:[["app-documentation"]],features:[w.ub],decls:53,vars:0,consts:[[1,"content"],["contentReference",""],[1,"github-links"],["href","https://github.com/nestjs/docs.nestjs.com/edit/master/content/recipes/documentation.md","aria-label","Suggest Edits","title","Suggest Edits"],[1,"fas","fa-edit"],["id","documentation"],["appAnchor","","id","setup"],[1,"language-bash"],["appAnchor","","id","generation"],["rel","nofollow","target","_blank","href","https://compodoc.app/guides/usage.html"],["rel","nofollow","target","_blank","href","http://localhost:8080"],["src","/assets/documentation-compodoc-1.jpg"],["src","/assets/documentation-compodoc-2.jpg"],["appAnchor","","id","contribute"],["rel","nofollow","target","_blank","href","https://github.com/compodoc/compodoc"]],template:function(e,t){1&e&&(w.Jb(0,"div",0,1),w.Jb(2,"div",2),w.Jb(3,"a",3),w.Hb(4,"i",4),w.Ib(),w.Ib(),w.Jb(5,"h3",5),w.lc(6,"Documentation"),w.Ib(),w.Jb(7,"p"),w.Jb(8,"strong"),w.lc(9,"Compodoc"),w.Ib(),w.lc(10," is a documentation tool for Angular applications. Since Nest and Angular share similar project and code structures, "),w.Jb(11,"strong"),w.lc(12,"Compodoc"),w.Ib(),w.lc(13," works with Nest applications as well."),w.Ib(),w.Jb(14,"h4",6),w.Jb(15,"span"),w.lc(16,"Setup"),w.Ib(),w.Ib(),w.Jb(17,"p"),w.lc(18,"Setting up Compodoc inside an existing Nest project is very simple. Start by adding the dev-dependency with the following command in your OS terminal:"),w.Ib(),w.Jb(19,"pre"),w.Jb(20,"code",7),w.lc(21,"\n$ npm i -D @compodoc/compodoc\n"),w.Ib(),w.Ib(),w.Jb(22,"h4",8),w.Jb(23,"span"),w.lc(24,"Generation"),w.Ib(),w.Ib(),w.Jb(25,"p"),w.lc(26,"Generate project documentation using the following command (npm 6 is required for "),w.Jb(27,"code"),w.lc(28,"npx"),w.Ib(),w.lc(29," support). See "),w.Jb(30,"a",9),w.lc(31,"the official documentation"),w.Ib(),w.lc(32," for more options."),w.Ib(),w.Jb(33,"pre"),w.Jb(34,"code",7),w.lc(35,"\n$ npx @compodoc/compodoc -p tsconfig.json -s\n"),w.Ib(),w.Ib(),w.Jb(36,"p"),w.lc(37,"Open your browser and navigate to "),w.Jb(38,"a",10),w.lc(39,"http://localhost:8080"),w.Ib(),w.lc(40,". You should see an initial Nest CLI project:"),w.Ib(),w.Jb(41,"figure"),w.Hb(42,"img",11),w.Ib(),w.Jb(43,"figure"),w.Hb(44,"img",12),w.Ib(),w.Jb(45,"h4",13),w.Jb(46,"span"),w.lc(47,"Contribute"),w.Ib(),w.Ib(),w.Jb(48,"p"),w.lc(49,"You can participate and contribute to the Compodoc project "),w.Jb(50,"a",14),w.lc(51,"here"),w.Ib(),w.lc(52,"."),w.Ib(),w.Ib())},directives:[v.a],encapsulation:2,changeDetection:0}),l),H=w.Lb(x),j=((i=function(n){t(c,n);var a=o(c);function c(){return e(this,c),a.apply(this,arguments)}return c}(y.a)).\u0275fac=function(e){return E(e||i)},i.\u0275cmp=w.Ab({type:i,selectors:[["app-hot-reload"]],features:[w.ub],decls:258,vars:4,consts:[[1,"content"],["contentReference",""],[1,"github-links"],["href","https://github.com/nestjs/docs.nestjs.com/edit/master/content/recipes/hot-reload.md","aria-label","Suggest Edits","title","Suggest Edits"],[1,"fas","fa-edit"],["id","hot-reload"],["rel","nofollow","target","_blank","href","https://github.com/webpack/webpack"],[1,"warning"],["id","with-cli"],["rel","nofollow","target","_blank","href","https://docs.nestjs.com/cli/overview"],["appAnchor","","id","installation"],[1,"language-bash"],[1,"info"],["appAnchor","","id","configuration"],[1,"language-typescript"],["appAnchor","","id","hot-module-replacement"],[1,"language-json"],["id","without-cli"],["appAnchor","","id","installation-1"],["appAnchor","","id","configuration-1"],["id","with-npm-or-yarn-classic"],["appAnchor","","id","hot-module-replacement-1"],["appAnchor","","id","example"],["rel","nofollow","target","_blank","href","https://github.com/nestjs/nest/tree/master/sample/08-webpack"],["id","typeorm"]],template:function(e,t){1&e&&(w.Jb(0,"div",0,1),w.Jb(2,"div",2),w.Jb(3,"a",3),w.Hb(4,"i",4),w.Ib(),w.Ib(),w.Jb(5,"h3",5),w.lc(6,"Hot Reload"),w.Ib(),w.Jb(7,"p"),w.lc(8,"The highest impact on your application's bootstrapping process is "),w.Jb(9,"strong"),w.lc(10,"TypeScript compilation"),w.Ib(),w.lc(11,". Fortunately, with "),w.Jb(12,"a",6),w.lc(13,"webpack"),w.Ib(),w.lc(14," HMR (Hot-Module Replacement), we don't need to recompile the entire project each time a change occurs. This significantly decreases the amount of time necessary to instantiate your application, and makes iterative development a lot easier."),w.Ib(),w.Jb(15,"blockquote",7),w.Jb(16,"strong"),w.lc(17,"Warning"),w.Ib(),w.lc(18," Note that "),w.Jb(19,"code"),w.lc(20,"webpack"),w.Ib(),w.lc(21," won't automatically copy your assets (e.g. "),w.Jb(22,"code"),w.lc(23,"graphql"),w.Ib(),w.lc(24," files) to the "),w.Jb(25,"code"),w.lc(26,"dist"),w.Ib(),w.lc(27," folder. Similarly, "),w.Jb(28,"code"),w.lc(29,"webpack"),w.Ib(),w.lc(30," is not compatible with glob static paths (e.g., the "),w.Jb(31,"code"),w.lc(32,"entities"),w.Ib(),w.lc(33," property in "),w.Jb(34,"code"),w.lc(35,"TypeOrmModule"),w.Ib(),w.lc(36,").\n"),w.Ib(),w.Jb(37,"h3",8),w.lc(38,"With CLI"),w.Ib(),w.Jb(39,"p"),w.lc(40,"If you are using the "),w.Jb(41,"a",9),w.lc(42,"Nest CLI"),w.Ib(),w.lc(43,", the configuration process is pretty straightforward. The CLI wraps "),w.Jb(44,"code"),w.lc(45,"webpack"),w.Ib(),w.lc(46,", which allows use of the "),w.Jb(47,"code"),w.lc(48,"HotModuleReplacementPlugin"),w.Ib(),w.lc(49,"."),w.Ib(),w.Jb(50,"h4",10),w.Jb(51,"span"),w.lc(52,"Installation"),w.Ib(),w.Ib(),w.Jb(53,"p"),w.lc(54,"First install the required packages:"),w.Ib(),w.Jb(55,"pre"),w.Jb(56,"code",11),w.lc(57,"\n$ npm i --save-dev webpack-node-externals run-script-webpack-plugin webpack\n"),w.Ib(),w.Ib(),w.Jb(58,"blockquote",12),w.Jb(59,"strong"),w.lc(60,"Hint"),w.Ib(),w.lc(61," If you use "),w.Jb(62,"strong"),w.lc(63,"Yarn Berry"),w.Ib(),w.lc(64," (not classic Yarn), install the "),w.Jb(65,"code"),w.lc(66,"webpack-pnp-externals"),w.Ib(),w.lc(67," package instead of the "),w.Jb(68,"code"),w.lc(69,"webpack-node-externals"),w.Ib(),w.lc(70,".\n"),w.Ib(),w.Jb(71,"h4",13),w.Jb(72,"span"),w.lc(73,"Configuration"),w.Ib(),w.Ib(),w.Jb(74,"p"),w.lc(75,"Once the installation is complete, create a "),w.Jb(76,"code"),w.lc(77,"webpack-hmr.config.js"),w.Ib(),w.lc(78," file in the root directory of your application."),w.Ib(),w.Jb(79,"pre"),w.Jb(80,"code",14),w.lc(81,"\nconst nodeExternals = require('webpack-node-externals');\nconst { RunScriptWebpackPlugin } = require('run-script-webpack-plugin');\n\nmodule.exports = function (options, webpack) {\n  return {\n    ...options,\n    entry: ['webpack/hot/poll?100', options.entry],\n    watch: true,\n    externals: [\n      nodeExternals({\n        allowlist: ['webpack/hot/poll?100'],\n      }),\n    ],\n    plugins: [\n      ...options.plugins,\n      new webpack.HotModuleReplacementPlugin(),\n      new webpack.WatchIgnorePlugin({\n        paths: [/\\.js$/, /\\.d\\.ts$/],\n      }),\n      new RunScriptWebpackPlugin({ name: options.output.filename }),\n    ],\n  };\n};\n"),w.Ib(),w.Ib(),w.Jb(82,"blockquote",12),w.Jb(83,"strong"),w.lc(84,"Hint"),w.Ib(),w.lc(85," With "),w.Jb(86,"strong"),w.lc(87,"Yarn Berry"),w.Ib(),w.lc(88," (not classic Yarn), instead of using the "),w.Jb(89,"code"),w.lc(90,"nodeExternals"),w.Ib(),w.lc(91," in the "),w.Jb(92,"code"),w.lc(93,"externals"),w.Ib(),w.lc(94," configuration property, use the "),w.Jb(95,"code"),w.lc(96,"WebpackPnpExternals"),w.Ib(),w.lc(97," from "),w.Jb(98,"code"),w.lc(99,"webpack-pnp-externals"),w.Ib(),w.lc(100," package: "),w.Jb(101,"code"),w.lc(102),w.Ib(),w.lc(103,".\n"),w.Ib(),w.Jb(104,"p"),w.lc(105,"This function takes the original object containing the default webpack configuration as a first argument, and the reference to the underlying "),w.Jb(106,"code"),w.lc(107,"webpack"),w.Ib(),w.lc(108," package used by the Nest CLI as the second one. Also, it returns a modified webpack configuration with the "),w.Jb(109,"code"),w.lc(110,"HotModuleReplacementPlugin"),w.Ib(),w.lc(111,", "),w.Jb(112,"code"),w.lc(113,"WatchIgnorePlugin"),w.Ib(),w.lc(114,", and "),w.Jb(115,"code"),w.lc(116,"RunScriptWebpackPlugin"),w.Ib(),w.lc(117," plugins."),w.Ib(),w.Jb(118,"h4",15),w.Jb(119,"span"),w.lc(120,"Hot-Module Replacement"),w.Ib(),w.Ib(),w.Jb(121,"p"),w.lc(122,"To enable "),w.Jb(123,"strong"),w.lc(124,"HMR"),w.Ib(),w.lc(125,", open the application entry file ("),w.Jb(126,"code"),w.lc(127,"main.ts"),w.Ib(),w.lc(128,") and add the following webpack-related instructions:"),w.Ib(),w.Jb(129,"pre"),w.Jb(130,"code",14),w.lc(131,"\ndeclare const module: any;\n\nasync function bootstrap() {\n  const app = await NestFactory.create(AppModule);\n  await app.listen(3000);\n\n  if (module.hot) {\n    module.hot.accept();\n    module.hot.dispose(() => app.close());\n  }\n}\nbootstrap();\n"),w.Ib(),w.Ib(),w.Jb(132,"p"),w.lc(133,"To simplify the execution process, add a script to your "),w.Jb(134,"code"),w.lc(135,"package.json"),w.Ib(),w.lc(136," file."),w.Ib(),w.Jb(137,"pre"),w.Jb(138,"code",16),w.lc(139,'\n"start:dev": "nest build --webpack --webpackPath webpack-hmr.config.js"\n'),w.Ib(),w.Ib(),w.Jb(140,"p"),w.lc(141,"Now simply open your command line and run the following command:"),w.Ib(),w.Jb(142,"pre"),w.Jb(143,"code",11),w.lc(144,"\n$ npm run start:dev\n"),w.Ib(),w.Ib(),w.Jb(145,"h3",17),w.lc(146,"Without CLI"),w.Ib(),w.Jb(147,"p"),w.lc(148,"If you are not using the "),w.Jb(149,"a",9),w.lc(150,"Nest CLI"),w.Ib(),w.lc(151,", the configuration will be slightly more complex (will require more manual steps)."),w.Ib(),w.Jb(152,"h4",18),w.Jb(153,"span"),w.lc(154,"Installation"),w.Ib(),w.Ib(),w.Jb(155,"p"),w.lc(156,"First install the required packages:"),w.Ib(),w.Jb(157,"pre"),w.Jb(158,"code",11),w.lc(159,"\n$ npm i --save-dev webpack webpack-cli webpack-node-externals ts-loader run-script-webpack-plugin\n"),w.Ib(),w.Ib(),w.Jb(160,"blockquote",12),w.Jb(161,"strong"),w.lc(162,"Hint"),w.Ib(),w.lc(163," If you use "),w.Jb(164,"strong"),w.lc(165,"Yarn Berry"),w.Ib(),w.lc(166," (not classic Yarn), install the "),w.Jb(167,"code"),w.lc(168,"webpack-pnp-externals"),w.Ib(),w.lc(169," package instead of the "),w.Jb(170,"code"),w.lc(171,"webpack-node-externals"),w.Ib(),w.lc(172,".\n"),w.Ib(),w.Jb(173,"h4",19),w.Jb(174,"span"),w.lc(175,"Configuration"),w.Ib(),w.Ib(),w.Jb(176,"p"),w.lc(177,"Once the installation is complete, create a "),w.Jb(178,"code"),w.lc(179,"webpack.config.js"),w.Ib(),w.lc(180," file in the root directory of your application."),w.Ib(),w.Jb(181,"h5",20),w.lc(182,"With NPM or Yarn classic"),w.Ib(),w.Jb(183,"pre"),w.Jb(184,"code",14),w.lc(185,"\nconst webpack = require('webpack');\nconst path = require('path');\nconst nodeExternals = require('webpack-node-externals');\nconst { RunScriptWebpackPlugin } = require('run-script-webpack-plugin');\n\nmodule.exports = {\n  entry: ['webpack/hot/poll?100', './src/main.ts'],\n  watch: true,\n  target: 'node',\n  externals: [\n    nodeExternals({\n      allowlist: ['webpack/hot/poll?100'],\n    }),\n  ],\n  module: {\n    rules: [\n      {\n        test: /.tsx?$/,\n        use: 'ts-loader',\n        exclude: /node_modules/,\n      },\n    ],\n  },\n  mode: 'development',\n  resolve: {\n    extensions: ['.tsx', '.ts', '.js'],\n  },\n  plugins: [\n    new webpack.HotModuleReplacementPlugin(),\n    new RunScriptWebpackPlugin({ name: 'server.js' }),\n  ],\n  output: {\n    path: path.join(__dirname, 'dist'),\n    filename: 'server.js',\n  },\n};\n"),w.Ib(),w.Ib(),w.Jb(186,"blockquote",12),w.Jb(187,"strong"),w.lc(188,"Hint"),w.Ib(),w.lc(189," With "),w.Jb(190,"strong"),w.lc(191,"Yarn Berry"),w.Ib(),w.lc(192," (not classic Yarn), instead of using the "),w.Jb(193,"code"),w.lc(194,"nodeExternals"),w.Ib(),w.lc(195," in the "),w.Jb(196,"code"),w.lc(197,"externals"),w.Ib(),w.lc(198," configuration property, use the "),w.Jb(199,"code"),w.lc(200,"WebpackPnpExternals"),w.Ib(),w.lc(201," from "),w.Jb(202,"code"),w.lc(203,"webpack-pnp-externals"),w.Ib(),w.lc(204," package: "),w.Jb(205,"code"),w.lc(206),w.Ib(),w.lc(207,".\n"),w.Ib(),w.Jb(208,"p"),w.lc(209,"This configuration tells webpack a few essential things about your application: location of the entry file, which directory should be used to hold "),w.Jb(210,"strong"),w.lc(211,"compiled"),w.Ib(),w.lc(212," files, and what kind of loader we want to use to compile source files. Generally, you should be able to use this file as-is, even if you don't fully understand all of the options."),w.Ib(),w.Jb(213,"h4",21),w.Jb(214,"span"),w.lc(215,"Hot-Module Replacement"),w.Ib(),w.Ib(),w.Jb(216,"p"),w.lc(217,"To enable "),w.Jb(218,"strong"),w.lc(219,"HMR"),w.Ib(),w.lc(220,", open the application entry file ("),w.Jb(221,"code"),w.lc(222,"main.ts"),w.Ib(),w.lc(223,") and add the following webpack-related instructions:"),w.Ib(),w.Jb(224,"pre"),w.Jb(225,"code",14),w.lc(226,"\ndeclare const module: any;\n\nasync function bootstrap() {\n  const app = await NestFactory.create(AppModule);\n  await app.listen(3000);\n\n  if (module.hot) {\n    module.hot.accept();\n    module.hot.dispose(() => app.close());\n  }\n}\nbootstrap();\n"),w.Ib(),w.Ib(),w.Jb(227,"p"),w.lc(228,"To simplify the execution process, add a script to your "),w.Jb(229,"code"),w.lc(230,"package.json"),w.Ib(),w.lc(231," file."),w.Ib(),w.Jb(232,"pre"),w.Jb(233,"code",16),w.lc(234,'\n"start:dev": "webpack --config webpack.config.js"\n'),w.Ib(),w.Ib(),w.Jb(235,"p"),w.lc(236,"Now simply open your command line and run the following command:"),w.Ib(),w.Jb(237,"pre"),w.Jb(238,"code",11),w.lc(239,"\n$ npm run start:dev\n"),w.Ib(),w.Ib(),w.Jb(240,"h4",22),w.Jb(241,"span"),w.lc(242,"Example"),w.Ib(),w.Ib(),w.Jb(243,"p"),w.lc(244,"A working example is available "),w.Jb(245,"a",23),w.lc(246,"here"),w.Ib(),w.lc(247,"."),w.Ib(),w.Jb(248,"h3",24),w.lc(249,"TypeORM"),w.Ib(),w.Jb(250,"p"),w.lc(251,"If you're using "),w.Jb(252,"code"),w.lc(253,"@nestjs/typeorm"),w.Ib(),w.lc(254,", you'll need to add "),w.Jb(255,"code"),w.lc(256,"keepConnectionAlive: true"),w.Ib(),w.lc(257," to your TypeORM configuration."),w.Ib(),w.Ib()),2&e&&(w.wb(102),w.oc("WebpackPnpExternals(","{"," exclude: ['webpack/hot/poll?100'] ","}",")"),w.wb(104),w.oc("WebpackPnpExternals(","{"," exclude: ['webpack/hot/poll?100'] ","}",")"))},directives:[v.a],encapsulation:2,changeDetection:0}),i),E=w.Lb(j),D=((b=function(n){t(c,n);var a=o(c);function c(){return e(this,c),a.apply(this,arguments)}return c}(y.a)).\u0275fac=function(e){return M(e||b)},b.\u0275cmp=w.Ab({type:b,selectors:[["app-mongodb"]],features:[w.ub],decls:226,vars:36,consts:[[1,"content"],["contentReference",""],[1,"github-links"],["href","https://github.com/nestjs/docs.nestjs.com/edit/master/content/recipes/mongodb.md","aria-label","Suggest Edits","title","Suggest Edits"],[1,"fas","fa-edit"],["id","mongodb-mongoose"],[1,""],["routerLink","/techniques/mongodb"],["rel","nofollow","target","_blank","href","https://mongoosejs.com"],["rel","nofollow","target","_blank","href","https://www.mongodb.org/"],["appAnchor","","id","getting-started"],[1,"language-typescript"],["routerLink","/fundamentals/async-components"],[1,"filename"],["app48c19d216a2e1bf9b09b08415759e1e581da8515",""],[1,"info"],["app7a9abb6ce4b6804ae0730573b9fe985640b7f84b",""],["appAnchor","","id","model-injection"],["rel","nofollow","target","_blank","href","https://mongoosejs.com/docs/guide.html"],["appf36466bad18fde07604e1d734625619f55add1d6",""],["app50673e3771e03feb58e76f1bb4d506021a3c618d",""],[1,"warning"],["app76c1b8a36d1e9b31765beb557f307c4f2b02a5b6",""],["app40977f281892b01a9e47496a3dd4ec789fbabbf9",""]],template:function(e,t){if(1&e&&(w.Jb(0,"div",0,1),w.Jb(2,"div",2),w.Jb(3,"a",3),w.Hb(4,"i",4),w.Ib(),w.Ib(),w.Jb(5,"h3",5),w.lc(6,"MongoDB (Mongoose)"),w.Ib(),w.Jb(7,"blockquote",6),w.Jb(8,"strong"),w.lc(9,"Warning"),w.Ib(),w.lc(10," In this article, you'll learn how to create a "),w.Jb(11,"code"),w.lc(12,"DatabaseModule"),w.Ib(),w.lc(13," based on the "),w.Jb(14,"strong"),w.lc(15,"Mongoose"),w.Ib(),w.lc(16," package from scratch using custom components. As a consequence, this solution contains a lot of overhead that you can omit using ready to use and available out-of-the-box dedicated "),w.Jb(17,"code"),w.lc(18,"@nestjs/mongoose"),w.Ib(),w.lc(19," package. To learn more, see "),w.Jb(20,"a",7),w.lc(21,"here"),w.Ib(),w.lc(22,".\n"),w.Ib(),w.Jb(23,"p"),w.Jb(24,"a",8),w.lc(25,"Mongoose"),w.Ib(),w.lc(26," is the most popular "),w.Jb(27,"a",9),w.lc(28,"MongoDB"),w.Ib(),w.lc(29," object modeling tool."),w.Ib(),w.Jb(30,"h4",10),w.Jb(31,"span"),w.lc(32,"Getting started"),w.Ib(),w.Ib(),w.Jb(33,"p"),w.lc(34,"To start the adventure with this library we have to install all required dependencies:"),w.Ib(),w.Jb(35,"pre"),w.Jb(36,"code",11),w.lc(37,"\n$ npm install --save mongoose\n"),w.Ib(),w.Ib(),w.Jb(38,"p"),w.lc(39,"The first step we need to do is to establish the connection with our database using "),w.Jb(40,"code"),w.lc(41,"connect()"),w.Ib(),w.lc(42," function. The "),w.Jb(43,"code"),w.lc(44,"connect()"),w.Ib(),w.lc(45," function returns a "),w.Jb(46,"code"),w.lc(47,"Promise"),w.Ib(),w.lc(48,", and therefore we have to create an "),w.Jb(49,"a",12),w.lc(50,"async provider"),w.Ib(),w.lc(51,"."),w.Ib(),w.Jb(52,"span",13),w.lc(53),w.Vb(54,"extension"),w.Hb(55,"app-tabs",null,14),w.Ib(),w.Jb(57,"pre"),w.Jb(58,"code",11),w.lc(59,"\nimport * as mongoose from 'mongoose';\n\nexport const databaseProviders = [\n  {\n    provide: 'DATABASE_CONNECTION',\n    useFactory: (): Promise<typeof mongoose> =>\n      mongoose.connect('mongodb://localhost/nest'),\n  },\n];\n"),w.Ib(),w.Ib(),w.Jb(60,"pre"),w.Jb(61,"code",11),w.lc(62,"\nimport * as mongoose from 'mongoose';\n\nexport const databaseProviders = [\n  {\n    provide: 'DATABASE_CONNECTION',\n    useFactory: () => mongoose.connect('mongodb://localhost/nest'),\n  },\n];\n"),w.Ib(),w.Ib(),w.Jb(63,"blockquote",15),w.Jb(64,"strong"),w.lc(65,"Hint"),w.Ib(),w.lc(66," Following best practices, we declared the custom provider in the separated file which has a "),w.Jb(67,"code"),w.lc(68,"*.providers.ts"),w.Ib(),w.lc(69," suffix.\n"),w.Ib(),w.Jb(70,"p"),w.lc(71,"Then, we need to export these providers to make them "),w.Jb(72,"strong"),w.lc(73,"accessible"),w.Ib(),w.lc(74," for the rest part of the application."),w.Ib(),w.Jb(75,"span",13),w.lc(76),w.Vb(77,"extension"),w.Hb(78,"app-tabs",null,16),w.Ib(),w.Jb(80,"pre"),w.Jb(81,"code",11),w.lc(82,"\nimport { Module } from '@nestjs/common';\nimport { databaseProviders } from './database.providers';\n\n@Module({\n  providers: [...databaseProviders],\n  exports: [...databaseProviders],\n})\nexport class DatabaseModule {}\n"),w.Ib(),w.Ib(),w.Jb(83,"p"),w.lc(84,"Now we can inject the "),w.Jb(85,"code"),w.lc(86,"Connection"),w.Ib(),w.lc(87," object using "),w.Jb(88,"code"),w.lc(89,"@Inject()"),w.Ib(),w.lc(90," decorator. Each class that would depend on the "),w.Jb(91,"code"),w.lc(92,"Connection"),w.Ib(),w.lc(93," async provider will wait until a "),w.Jb(94,"code"),w.lc(95,"Promise"),w.Ib(),w.lc(96," is resolved."),w.Ib(),w.Jb(97,"h4",17),w.Jb(98,"span"),w.lc(99,"Model injection"),w.Ib(),w.Ib(),w.Jb(100,"p"),w.lc(101,"With Mongoose, everything is derived from a "),w.Jb(102,"a",18),w.lc(103,"Schema"),w.Ib(),w.lc(104,". Let's define the "),w.Jb(105,"code"),w.lc(106,"CatSchema"),w.Ib(),w.lc(107,":"),w.Ib(),w.Jb(108,"span",13),w.lc(109),w.Vb(110,"extension"),w.Hb(111,"app-tabs",null,19),w.Ib(),w.Jb(113,"pre"),w.Jb(114,"code",11),w.lc(115,"\nimport * as mongoose from 'mongoose';\n\nexport const CatSchema = new mongoose.Schema({\n  name: String,\n  age: Number,\n  breed: String,\n});\n"),w.Ib(),w.Ib(),w.Jb(116,"p"),w.lc(117,"The "),w.Jb(118,"code"),w.lc(119,"CatsSchema"),w.Ib(),w.lc(120," belongs to the "),w.Jb(121,"code"),w.lc(122,"cats"),w.Ib(),w.lc(123," directory. This directory represents the "),w.Jb(124,"code"),w.lc(125,"CatsModule"),w.Ib(),w.lc(126,"."),w.Ib(),w.Jb(127,"p"),w.lc(128,"Now it's time to create a "),w.Jb(129,"strong"),w.lc(130,"Model"),w.Ib(),w.lc(131," provider:"),w.Ib(),w.Jb(132,"span",13),w.lc(133),w.Vb(134,"extension"),w.Hb(135,"app-tabs",null,20),w.Ib(),w.Jb(137,"pre"),w.Jb(138,"code",11),w.lc(139,"\nimport { Connection } from 'mongoose';\nimport { CatSchema } from './schemas/cat.schema';\n\nexport const catsProviders = [\n  {\n    provide: 'CAT_MODEL',\n    useFactory: (connection: Connection) => connection.model('Cat', CatSchema),\n    inject: ['DATABASE_CONNECTION'],\n  },\n];\n"),w.Ib(),w.Ib(),w.Jb(140,"pre"),w.Jb(141,"code",11),w.lc(142,"\nimport { CatSchema } from './schemas/cat.schema';\n\nexport const catsProviders = [\n  {\n    provide: 'CAT_MODEL',\n    useFactory: (connection) => connection.model('Cat', CatSchema),\n    inject: ['DATABASE_CONNECTION'],\n  },\n];\n"),w.Ib(),w.Ib(),w.Jb(143,"blockquote",21),w.Jb(144,"strong"),w.lc(145,"Warning"),w.Ib(),w.lc(146," In the real-world applications you should avoid "),w.Jb(147,"strong"),w.lc(148,"magic strings"),w.Ib(),w.lc(149,". Both "),w.Jb(150,"code"),w.lc(151,"CAT_MODEL"),w.Ib(),w.lc(152," and "),w.Jb(153,"code"),w.lc(154,"DATABASE_CONNECTION"),w.Ib(),w.lc(155," should be kept in the separated "),w.Jb(156,"code"),w.lc(157,"constants.ts"),w.Ib(),w.lc(158," file.\n"),w.Ib(),w.Jb(159,"p"),w.lc(160,"Now we can inject the "),w.Jb(161,"code"),w.lc(162,"CAT_MODEL"),w.Ib(),w.lc(163," to the "),w.Jb(164,"code"),w.lc(165,"CatsService"),w.Ib(),w.lc(166," using the "),w.Jb(167,"code"),w.lc(168,"@Inject()"),w.Ib(),w.lc(169," decorator:"),w.Ib(),w.Jb(170,"span",13),w.lc(171),w.Vb(172,"extension"),w.Hb(173,"app-tabs",null,22),w.Ib(),w.Jb(175,"pre"),w.Jb(176,"code",11),w.lc(177,"\nimport { Model } from 'mongoose';\nimport { Injectable, Inject } from '@nestjs/common';\nimport { Cat } from './interfaces/cat.interface';\nimport { CreateCatDto } from './dto/create-cat.dto';\n\n@Injectable()\nexport class CatsService {\n  constructor(\n    @Inject('CAT_MODEL')\n    private catModel: Model<Cat>,\n  ) {}\n\n  async create(createCatDto: CreateCatDto): Promise<Cat> {\n    const createdCat = new this.catModel(createCatDto);\n    return createdCat.save();\n  }\n\n  async findAll(): Promise<Cat[]> {\n    return this.catModel.find().exec();\n  }\n}\n"),w.Ib(),w.Ib(),w.Jb(178,"pre"),w.Jb(179,"code",11),w.lc(180,"\nimport { Injectable, Dependencies } from '@nestjs/common';\n\n@Injectable()\n@Dependencies('CAT_MODEL')\nexport class CatsService {\n  constructor(catModel) {\n    this.catModel = catModel;\n  }\n\n  async create(createCatDto) {\n    const createdCat = new this.catModel(createCatDto);\n    return createdCat.save();\n  }\n\n  async findAll() {\n    return this.catModel.find().exec();\n  }\n}\n"),w.Ib(),w.Ib(),w.Jb(181,"p"),w.lc(182,"In the above example we have used the "),w.Jb(183,"code"),w.lc(184,"Cat"),w.Ib(),w.lc(185," interface. This interface extends the "),w.Jb(186,"code"),w.lc(187,"Document"),w.Ib(),w.lc(188," from the mongoose package:"),w.Ib(),w.Jb(189,"pre"),w.Jb(190,"code",11),w.lc(191,"\nimport { Document } from 'mongoose';\n\nexport interface Cat extends Document {\n  readonly name: string;\n  readonly age: number;\n  readonly breed: string;\n}\n"),w.Ib(),w.Ib(),w.Jb(192,"p"),w.lc(193,"The database connection is "),w.Jb(194,"strong"),w.lc(195,"asynchronous"),w.Ib(),w.lc(196,", but Nest makes this process completely invisible for the end-user. The "),w.Jb(197,"code"),w.lc(198,"CatModel"),w.Ib(),w.lc(199," class is waiting for the db connection, and the "),w.Jb(200,"code"),w.lc(201,"CatsService"),w.Ib(),w.lc(202," is delayed until model is ready to use. The entire application can start when each class is instantiated."),w.Ib(),w.Jb(203,"p"),w.lc(204,"Here is a final "),w.Jb(205,"code"),w.lc(206,"CatsModule"),w.Ib(),w.lc(207,":"),w.Ib(),w.Jb(208,"span",13),w.lc(209),w.Vb(210,"extension"),w.Hb(211,"app-tabs",null,23),w.Ib(),w.Jb(213,"pre"),w.Jb(214,"code",11),w.lc(215,"\nimport { Module } from '@nestjs/common';\nimport { CatsController } from './cats.controller';\nimport { CatsService } from './cats.service';\nimport { catsProviders } from './cats.providers';\nimport { DatabaseModule } from '../database/database.module';\n\n@Module({\n  imports: [DatabaseModule],\n  controllers: [CatsController],\n  providers: [\n    CatsService,\n    ...catsProviders,\n  ],\n})\nexport class CatsModule {}\n"),w.Ib(),w.Ib(),w.Jb(216,"blockquote",15),w.Jb(217,"strong"),w.lc(218,"Hint"),w.Ib(),w.lc(219," Do not forget to import the "),w.Jb(220,"code"),w.lc(221,"CatsModule"),w.Ib(),w.lc(222," into the root "),w.Jb(223,"code"),w.lc(224,"ApplicationModule"),w.Ib(),w.lc(225,".\n"),w.Ib(),w.Ib()),2&e){var n=w.ec(56),o=w.ec(79),a=w.ec(112),c=w.ec(136),s=w.ec(174),r=w.ec(212);w.wb(53),w.nc(" ",w.Wb(54,18,"database.providers",n.isJsActive),"\n"),w.wb(4),w.yb("hide",n.isJsActive),w.wb(3),w.yb("hide",!n.isJsActive),w.wb(16),w.nc(" ",w.Wb(77,21,"database.module",o.isJsActive),"\n"),w.wb(33),w.nc(" ",w.Wb(110,24,"schemas/cat.schema",a.isJsActive),"\n"),w.wb(24),w.nc(" ",w.Wb(134,27,"cats.providers",c.isJsActive),"\n"),w.wb(4),w.yb("hide",c.isJsActive),w.wb(3),w.yb("hide",!c.isJsActive),w.wb(31),w.nc(" ",w.Wb(172,30,"cats.service",s.isJsActive),"\n"),w.wb(4),w.yb("hide",s.isJsActive),w.wb(3),w.yb("hide",!s.isJsActive),w.wb(31),w.nc(" ",w.Wb(210,33,"cats.module",r.isJsActive),"\n")}},directives:[g.f,v.a,k.a],pipes:[C.a],encapsulation:2,changeDetection:0}),b),M=w.Lb(D),R=((d=function(n){t(c,n);var a=o(c);function c(){return e(this,c),a.apply(this,arguments)}return c}(y.a)).\u0275fac=function(e){return q(e||d)},d.\u0275cmp=w.Ab({type:d,selectors:[["app-prisma"]],features:[w.ub],decls:586,vars:0,consts:[[1,"content"],["contentReference",""],[1,"github-links"],["href","https://github.com/nestjs/docs.nestjs.com/edit/master/content/recipes/prisma.md","aria-label","Suggest Edits","title","Suggest Edits"],[1,"fas","fa-edit"],["id","prisma"],["rel","nofollow","target","_blank","href","https://www.prisma.io"],["rel","nofollow","target","_blank","href","https://github.com/prisma/prisma"],["rel","nofollow","target","_blank","href","https://knexjs.org/"],["rel","nofollow","target","_blank","href","https://typeorm.io/"],["rel","nofollow","target","_blank","href","https://sequelize.org/"],["rel","nofollow","target","_blank","href","https://www.prisma.io/docs/concepts/more/comparisons/prisma-and-typeorm#type-safety"],[1,"info"],["rel","nofollow","target","_blank","href","https://www.prisma.io/docs/getting-started/quickstart"],["rel","nofollow","target","_blank","href","https://www.prisma.io/docs/understand-prisma/introduction"],["rel","nofollow","target","_blank","href","https://www.prisma.io/docs/"],["rel","nofollow","target","_blank","href","https://github.com/prisma/prisma-examples/tree/latest/typescript/rest-nestjs"],["rel","nofollow","target","_blank","href","https://github.com/prisma/prisma-examples/tree/latest/typescript/graphql-nestjs"],["rel","nofollow","target","_blank","href","https://github.com/prisma/prisma-examples/"],["appAnchor","","id","getting-started"],["rel","nofollow","target","_blank","href","https://sqlite.org/"],["rel","nofollow","target","_blank","href","https://www.prisma.io/docs/getting-started/setup-prisma/add-to-existing-project-typescript-postgres"],["rel","nofollow","target","_blank","href","https://www.prisma.io/docs/guides/migrate-to-prisma/migrate-from-typeorm"],["appAnchor","","id","create-your-nestjs-project"],[1,"language-bash"],["rel","nofollow","target","_blank","href","https://docs.nestjs.com/first-steps"],["appAnchor","","id","set-up-prisma"],["rel","nofollow","target","_blank","href","https://www.prisma.io/docs/reference/tools-and-interfaces/prisma-cli"],["rel","nofollow","target","_blank","href","https://github.com/motdotla/dotenv"],["appAnchor","","id","set-the-database-connection"],[1,"language-groovy"],["rel","nofollow","target","_blank","href","https://www.prisma.io/docs/reference/database-reference/connection-urls"],["rel","nofollow","target","_blank","href","https://dev.to/prisma/how-to-setup-a-free-postgresql-database-on-heroku-1dc1"],["appAnchor","","id","create-two-database-tables-with-prisma-migrate"],["rel","nofollow","target","_blank","href","https://www.prisma.io/docs/concepts/components/prisma-migrate"],["rel","nofollow","target","_blank","href","https://www.prisma.io/docs/about/releases#preview"],[1,"language-sql"],["appAnchor","","id","install-and-generate-prisma-client"],["rel","nofollow","target","_blank","href","https://www.prisma.io/docs/concepts/components/prisma-client/crud"],["appAnchor","","id","use-prisma-client-in-your-nestjs-services"],["rel","nofollow","target","_blank","href","https://www.prisma.io/docs/reference/tools-and-interfaces/prisma-client/crud"],[1,"language-typescript"],["id","implement-your-rest-api-routes-in-the-main-app-controller"],["id","get"],["id","post"],["id","put"],["id","delete"],["appAnchor","","id","summary"],["rel","nofollow","target","_blank","href","https://www.prisma.io/nestjs"],["rel","nofollow","target","_blank","href","https://github.com/fivethree-team/nestjs-prisma-starter#instructions"],["rel","nofollow","target","_blank","href","https://www.youtube.com/watch?v=UlVJ340UEuk&ab_channel=Prisma"],["rel","nofollow","target","_blank","href","https://github.com/marcjulian"]],template:function(e,t){if(1&e){w.Jb(0,"div",0,1),w.Jb(2,"div",2),w.Jb(3,"a",3),w.Hb(4,"i",4),w.Ib(),w.Ib(),w.Jb(5,"h3",5),w.lc(6,"Prisma"),w.Ib(),w.Jb(7,"p"),w.Jb(8,"a",6),w.lc(9,"Prisma"),w.Ib(),w.lc(10," is an "),w.Jb(11,"a",7),w.lc(12,"open-source"),w.Ib(),w.lc(13," ORM for Node.js and TypeScript. It is used as an "),w.Jb(14,"strong"),w.lc(15,"alternative"),w.Ib(),w.lc(16," to writing plain SQL, or using another database access tool such as SQL query builders (like "),w.Jb(17,"a",8),w.lc(18,"knex.js"),w.Ib(),w.lc(19,") or ORMs (like "),w.Jb(20,"a",9),w.lc(21,"TypeORM"),w.Ib(),w.lc(22," and "),w.Jb(23,"a",10),w.lc(24,"Sequelize"),w.Ib(),w.lc(25,"). Prisma currently supports PostgreSQL, MySQL, SQL Server and SQLite."),w.Ib(),w.Jb(26,"p"),w.lc(27,"While Prisma can be used with plain JavaScript, it embraces TypeScript and provides a level to type-safety that goes beyond the guarantees other ORMs in the TypeScript ecosystem. You can find an in-depth comparison of the type-safety guarantees of Prisma and TypeORM "),w.Jb(28,"a",11),w.lc(29,"here"),w.Ib(),w.lc(30,"."),w.Ib(),w.Jb(31,"blockquote",12),w.Jb(32,"strong"),w.lc(33,"Note"),w.Ib(),w.lc(34," If you want to get a quick overview of how Prisma works, you can follow the "),w.Jb(35,"a",13),w.lc(36,"Quickstart"),w.Ib(),w.lc(37," or read the "),w.Jb(38,"a",14),w.lc(39,"Introduction"),w.Ib(),w.lc(40," in the "),w.Jb(41,"a",15),w.lc(42,"documentation"),w.Ib(),w.lc(43,". There also are ready-to-run examples for "),w.Jb(44,"a",16),w.lc(45,"REST"),w.Ib(),w.lc(46," and "),w.Jb(47,"a",17),w.lc(48,"GraphQL"),w.Ib(),w.lc(49," in the "),w.Jb(50,"a",18),w.Jb(51,"code"),w.lc(52,"prisma-examples"),w.Ib(),w.Ib(),w.lc(53," repo. "),w.Ib(),w.Jb(54,"h4",19),w.Jb(55,"span"),w.lc(56,"Getting started"),w.Ib(),w.Ib(),w.Jb(57,"p"),w.lc(58,"In this recipe, you'll learn how to get started with NestJS and Prisma from scratch. You are going to build a sample NestJS application with a REST API that can read and write data in a database."),w.Ib(),w.Jb(59,"p"),w.lc(60,"For the purpose of this guide, you'll use a "),w.Jb(61,"a",20),w.lc(62,"SQLite"),w.Ib(),w.lc(63," database to save the overhead of setting up a database server. Note that you can still follow this guide, even if you're using PostgreSQL or MySQL \u2013 you'll get extra instructions for using these databases at the right places."),w.Ib(),w.Jb(64,"blockquote",12),w.Jb(65,"strong"),w.lc(66,"Note"),w.Ib(),w.lc(67," If you already have an existing project and consider migrating to Prisma, you can follow the guide for "),w.Jb(68,"a",21),w.lc(69,"adding Prisma to an existing project"),w.Ib(),w.lc(70,". If you are migrating from TypeORM, you can read the guide "),w.Jb(71,"a",22),w.lc(72,"Migrating from TypeORM to Prisma"),w.Ib(),w.lc(73,".\n"),w.Ib(),w.Jb(74,"h4",23),w.Jb(75,"span"),w.lc(76,"Create your NestJS project"),w.Ib(),w.Ib(),w.Jb(77,"p"),w.lc(78,"To get started, install the NestJS CLI and create your app skeleton with the following commands:"),w.Ib(),w.Jb(79,"pre"),w.Jb(80,"code",24),w.lc(81,"\n$ npm install -g @nestjs/cli\n$ nest new hello-prisma\n"),w.Ib(),w.Ib(),w.Jb(82,"p"),w.lc(83,"See the "),w.Jb(84,"a",25),w.lc(85,"First steps"),w.Ib(),w.lc(86," page to learn more about the project files created by this command. Note also that you can now run "),w.Jb(87,"code"),w.lc(88,"npm start"),w.Ib(),w.lc(89," to start your application. The REST API running at "),w.Jb(90,"code"),w.lc(91,"http://localhost:3000/"),w.Ib(),w.lc(92," currently serves a single route that's implemented in "),w.Jb(93,"code"),w.lc(94,"src/app.controller.ts"),w.Ib(),w.lc(95,". Over the course of this guide, you'll implement additional routes to store and retrieve data about "),w.Jb(96,"em"),w.lc(97,"users"),w.Ib(),w.lc(98," and "),w.Jb(99,"em"),w.lc(100,"posts"),w.Ib(),w.lc(101,"."),w.Ib(),w.Jb(102,"h4",26),w.Jb(103,"span"),w.lc(104,"Set up Prisma"),w.Ib(),w.Ib(),w.Jb(105,"p"),w.lc(106,"Start by installing the Prisma CLI as a development dependency in your project:"),w.Ib(),w.Jb(107,"pre"),w.Jb(108,"code",24),w.lc(109,"\n$ cd hello-prisma\n$ npm install prisma --save-dev\n"),w.Ib(),w.Ib(),w.Jb(110,"p"),w.lc(111,"In the following steps, we'll be utilizing the "),w.Jb(112,"a",27),w.lc(113,"Prisma CLI"),w.Ib(),w.lc(114,". As a best practice, it's recommended to invoke the CLI locally by prefixing it with "),w.Jb(115,"code"),w.lc(116,"npx"),w.Ib(),w.lc(117,":"),w.Ib(),w.Jb(118,"pre"),w.Jb(119,"code",24),w.lc(120,"\n$ npx prisma\n"),w.Ib(),w.Ib(),w.Jb(121,"details"),w.Jb(122,"summary"),w.lc(123,"Expand if you're using Yarn"),w.Ib(),w.Jb(124,"p"),w.lc(125,"If you're using Yarn, then you can install the Prisma CLI as follows:"),w.Ib(),w.Jb(126,"pre"),w.Jb(127,"code",24),w.lc(128,"\n$ yarn add prisma --dev\n"),w.Ib(),w.Ib(),w.Jb(129,"p"),w.lc(130,"Once installed, you can invoke it by prefixing it with "),w.Jb(131,"code"),w.lc(132,"yarn"),w.Ib(),w.lc(133,":"),w.Ib(),w.Jb(134,"pre"),w.Jb(135,"code",24),w.lc(136,"\n$ yarn prisma\n"),w.Ib(),w.Ib(),w.Ib(),w.Jb(137,"p"),w.lc(138,"Now create your initial Prisma setup using the "),w.Jb(139,"code"),w.lc(140,"init"),w.Ib(),w.lc(141," command of the Prisma CLI:"),w.Ib(),w.Jb(142,"pre"),w.Jb(143,"code",24),w.lc(144,"\n$ npx prisma init\n"),w.Ib(),w.Ib(),w.Jb(145,"p"),w.lc(146,"This command creates a new "),w.Jb(147,"code"),w.lc(148,"prisma"),w.Ib(),w.lc(149," directory with the following contents:"),w.Ib(),w.Jb(150,"ul"),w.Jb(151,"li"),w.Jb(152,"code"),w.lc(153,"schema.prisma"),w.Ib(),w.lc(154,": Specifies your database connection and contains the database schema"),w.Ib(),w.Jb(155,"li"),w.Jb(156,"code"),w.lc(157,".env"),w.Ib(),w.lc(158,": A "),w.Jb(159,"a",28),w.lc(160,"dotenv"),w.Ib(),w.lc(161," file, typically used to store your database credentials in a group of environment variables"),w.Ib(),w.Ib(),w.Jb(162,"h4",29),w.Jb(163,"span"),w.lc(164,"Set the database connection"),w.Ib(),w.Ib(),w.Jb(165,"p"),w.lc(166,"Your database connection is configured in the "),w.Jb(167,"code"),w.lc(168,"datasource"),w.Ib(),w.lc(169," block in your "),w.Jb(170,"code"),w.lc(171,"schema.prisma"),w.Ib(),w.lc(172," file. By default it's set to "),w.Jb(173,"code"),w.lc(174,"postgresql"),w.Ib(),w.lc(175,", but since you're using a SQLite database in this guide you need to adjust the "),w.Jb(176,"code"),w.lc(177,"provider"),w.Ib(),w.lc(178," field of the "),w.Jb(179,"code"),w.lc(180,"datasource"),w.Ib(),w.lc(181," block to "),w.Jb(182,"code"),w.lc(183,"sqlite"),w.Ib(),w.lc(184,":"),w.Ib(),w.Jb(185,"pre"),w.Jb(186,"code",30),w.lc(187,'\ndatasource db {\n  provider = "sqlite"\n  url      = env("DATABASE_URL")\n}\n\ngenerator client {\n  provider = "prisma-client-js"\n}\n'),w.Ib(),w.Ib(),w.Jb(188,"p"),w.lc(189,"Now, open up "),w.Jb(190,"code"),w.lc(191,".env"),w.Ib(),w.lc(192," and adjust the "),w.Jb(193,"code"),w.lc(194,"DATABASE_URL"),w.Ib(),w.lc(195," environment variable to look as follows:"),w.Ib(),w.Jb(196,"pre"),w.Jb(197,"code",24),w.lc(198,'\nDATABASE_URL="file:./dev.db"\n'),w.Ib(),w.Ib(),w.Jb(199,"p"),w.lc(200,"SQLite databases are simple files; no server is required to use a SQLite database. So instead of configuring a connection URL with a "),w.Jb(201,"em"),w.lc(202,"host"),w.Ib(),w.lc(203," and "),w.Jb(204,"em"),w.lc(205,"port"),w.Ib(),w.lc(206,", you can just point it to a local file which in this case is called "),w.Jb(207,"code"),w.lc(208,"dev.db"),w.Ib(),w.lc(209,". This file will be created in the next step."),w.Ib(),w.Jb(210,"details"),w.Jb(211,"summary"),w.lc(212,"Expand if you're using PostgreSQL or MySQL"),w.Ib(),w.Jb(213,"p"),w.lc(214,"With PostgreSQL and MySQL, you need to configure the connection URL to point to the "),w.Jb(215,"em"),w.lc(216,"database server"),w.Ib(),w.lc(217,". You can learn more about the required connection URL format "),w.Jb(218,"a",31),w.lc(219,"here"),w.Ib(),w.lc(220,"."),w.Ib(),w.Jb(221,"p"),w.Jb(222,"strong"),w.lc(223,"PostgreSQL"),w.Ib(),w.Ib(),w.Jb(224,"p"),w.lc(225,"If you're using PostgreSQL, you have to adjust the "),w.Jb(226,"code"),w.lc(227,"schema.prisma"),w.Ib(),w.lc(228," and "),w.Jb(229,"code"),w.lc(230,".env"),w.Ib(),w.lc(231," files as follows:"),w.Ib(),w.Jb(232,"p"),w.Jb(233,"strong"),w.Jb(234,"code"),w.lc(235,"schema.prisma"),w.Ib(),w.Ib(),w.Ib(),w.Jb(236,"pre"),w.Jb(237,"code",30),w.lc(238,'\ndatasource db {\n  provider = "postgresql"\n  url      = env("DATABASE_URL")\n}\n\ngenerator client {\n  provider = "prisma-client-js"\n}\n'),w.Ib(),w.Ib(),w.Jb(239,"p"),w.Jb(240,"strong"),w.Jb(241,"code"),w.lc(242,".env"),w.Ib(),w.Ib(),w.Ib(),w.Jb(243,"pre"),w.Jb(244,"code",24),w.lc(245,'\nDATABASE_URL="postgresql://USER:PASSWORD@HOST:PORT/DATABASE?schema=SCHEMA"\n'),w.Ib(),w.Ib(),w.Jb(246,"p"),w.lc(247,"Replace the placeholders spelled in all uppercase letters with your database credentials. Note that if you're unsure what to provide for the "),w.Jb(248,"code"),w.lc(249,"SCHEMA"),w.Ib(),w.lc(250," placeholder, it's most likely the default value "),w.Jb(251,"code"),w.lc(252,"public"),w.Ib(),w.lc(253,":"),w.Ib(),w.Jb(254,"pre"),w.Jb(255,"code",24),w.lc(256,'\nDATABASE_URL="postgresql://USER:PASSWORD@HOST:PORT/DATABASE?schema=public"\n'),w.Ib(),w.Ib(),w.Jb(257,"p"),w.lc(258,"If you want to learn how to set up a PostgreSQL database, you can follow this guide on "),w.Jb(259,"a",32),w.lc(260,"setting up a free PostgreSQL database on Heroku"),w.Ib(),w.lc(261,"."),w.Ib(),w.Jb(262,"p"),w.Jb(263,"strong"),w.lc(264,"MySQL"),w.Ib(),w.Ib(),w.Jb(265,"p"),w.lc(266,"If you're using MySQL, you have to adjust the "),w.Jb(267,"code"),w.lc(268,"schema.prisma"),w.Ib(),w.lc(269," and "),w.Jb(270,"code"),w.lc(271,".env"),w.Ib(),w.lc(272," files as follows:"),w.Ib(),w.Jb(273,"p"),w.Jb(274,"strong"),w.Jb(275,"code"),w.lc(276,"schema.prisma"),w.Ib(),w.Ib(),w.Ib(),w.Jb(277,"pre"),w.Jb(278,"code",30),w.lc(279,'\ndatasource db {\n  provider = "mysql"\n  url      = env("DATABASE_URL")\n}\n\ngenerator client {\n  provider = "prisma-client-js"\n}\n'),w.Ib(),w.Ib(),w.Jb(280,"p"),w.Jb(281,"strong"),w.Jb(282,"code"),w.lc(283,".env"),w.Ib(),w.Ib(),w.Ib(),w.Jb(284,"pre"),w.Jb(285,"code",24),w.lc(286,'\nDATABASE_URL="mysql://USER:PASSWORD@HOST:PORT/DATABASE"\n'),w.Ib(),w.Ib(),w.Jb(287,"p"),w.lc(288,"Replace the placeholders spelled in all uppercase letters with your database credentials."),w.Ib(),w.Ib(),w.Jb(289,"h4",33),w.Jb(290,"span"),w.lc(291,"Create two database tables with Prisma Migrate"),w.Ib(),w.Ib(),w.Jb(292,"p"),w.lc(293,"In this section, you'll create two new tables in your database using "),w.Jb(294,"a",34),w.lc(295,"Prisma Migrate"),w.Ib(),w.lc(296,". Prisma Migrate generates SQL migration files for your declarative data model definition in the Prisma schema. These migration files are fully customizable so that you can configure any additional features of the underlying database or include additional commands, e.g. for seeding."),w.Ib(),w.Jb(297,"p"),w.lc(298,"Add the following two models to your "),w.Jb(299,"code"),w.lc(300,"schema.prisma"),w.Ib(),w.lc(301," file:"),w.Ib(),w.Jb(302,"pre"),w.Jb(303,"code",30),w.lc(304,"\nmodel User {\n  id    Int     @default(autoincrement()) @id\n  email String  @unique\n  name  String?\n  posts Post[]\n}\n\nmodel Post {\n  id        Int      @default(autoincrement()) @id\n  title     String\n  content   String?\n  published Boolean? @default(false)\n  author    User?    @relation(fields: [authorId], references: [id])\n  authorId  Int?\n}\n"),w.Ib(),w.Ib(),w.Jb(305,"p"),w.lc(306,"With your Prisma models in place, you can generate your SQL migration files and run them against the database. Run the following commands in your terminal:"),w.Ib(),w.Jb(307,"pre"),w.Jb(308,"code",24),w.lc(309,"\n$ npx prisma migrate dev --name init --preview-feature\n"),w.Ib(),w.Ib(),w.Jb(310,"blockquote",12),w.Jb(311,"strong"),w.lc(312,"Note"),w.Ib(),w.lc(313," The "),w.Jb(314,"code"),w.lc(315,"prisma migrate"),w.Ib(),w.lc(316," commands currently requires the "),w.Jb(317,"code"),w.lc(318,"--preview-feature"),w.Ib(),w.lc(319," option as it's in "),w.Jb(320,"a",35),w.lc(321,"Preview"),w.Ib(),w.lc(322,".\n"),w.Ib(),w.Jb(323,"p"),w.lc(324,"This "),w.Jb(325,"code"),w.lc(326,"prisma migrate dev"),w.Ib(),w.lc(327," command generates SQL files and directly runs them against the database. In this case, the following migration files was created in the existing "),w.Jb(328,"code"),w.lc(329,"prisma"),w.Ib(),w.lc(330," directory:"),w.Ib(),w.Jb(331,"pre"),w.Jb(332,"code",24),w.lc(333,"\n$ tree prisma\nprisma\n\u251c\u2500\u2500 dev.db\n\u251c\u2500\u2500 migrations\n\u2502   \u2514\u2500\u2500 20201207100915_init\n\u2502       \u2514\u2500\u2500 migration.sql\n\u2514\u2500\u2500 schema.prisma\n"),w.Ib(),w.Ib(),w.Jb(334,"details"),w.Jb(335,"summary"),w.lc(336,"Expand to view the generated SQL statements"),w.Ib(),w.Jb(337,"p"),w.lc(338,"The following tables were created in your SQLite database:"),w.Ib(),w.Jb(339,"pre"),w.Jb(340,"code",36),w.lc(341,'\n-- CreateTable\nCREATE TABLE "User" (\n    "id" INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,\n    "email" TEXT NOT NULL,\n    "name" TEXT\n);\n\n-- CreateTable\nCREATE TABLE "Post" (\n    "id" INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,\n    "title" TEXT NOT NULL,\n    "content" TEXT,\n    "published" BOOLEAN DEFAULT false,\n    "authorId" INTEGER,\n\n    FOREIGN KEY ("authorId") REFERENCES "User"("id") ON DELETE SET NULL ON UPDATE CASCADE\n);\n\n-- CreateIndex\nCREATE UNIQUE INDEX "User.email_unique" ON "User"("email");\n'),w.Ib(),w.Ib(),w.Ib(),w.Jb(342,"h4",37),w.Jb(343,"span"),w.lc(344,"Install and generate Prisma Client"),w.Ib(),w.Ib(),w.Jb(345,"p"),w.lc(346,"Prisma Client is a type-safe database client that's "),w.Jb(347,"em"),w.lc(348,"generated"),w.Ib(),w.lc(349," from your Prisma model definition. Because of this approach, Prisma Client can expose "),w.Jb(350,"a",38),w.lc(351,"CRUD"),w.Ib(),w.lc(352," operations that are "),w.Jb(353,"em"),w.lc(354,"tailored"),w.Ib(),w.lc(355," specifically to your models."),w.Ib(),w.Jb(356,"p"),w.lc(357,"To install Prisma Client in your project, run the following command in your terminal:"),w.Ib(),w.Jb(358,"pre"),w.Jb(359,"code",24),w.lc(360,"\n$ npm install @prisma/client\n"),w.Ib(),w.Ib(),w.Jb(361,"p"),w.lc(362,"Note that during installation, Prisma automatically invokes the "),w.Jb(363,"code"),w.lc(364,"prisma generate"),w.Ib(),w.lc(365," command for you. In the future, you need to run this command after "),w.Jb(366,"em"),w.lc(367,"every"),w.Ib(),w.lc(368," change to your Prisma models to update your generated Prisma Client."),w.Ib(),w.Jb(369,"blockquote",12),w.Jb(370,"strong"),w.lc(371,"Note"),w.Ib(),w.lc(372," The "),w.Jb(373,"code"),w.lc(374,"prisma generate"),w.Ib(),w.lc(375," command reads your Prisma schema and updates the generated Prisma Client library inside "),w.Jb(376,"code"),w.lc(377,"node_modules/@prisma/client"),w.Ib(),w.lc(378,".\n"),w.Ib(),w.Jb(379,"h4",39),w.Jb(380,"span"),w.lc(381,"Use Prisma Client in your NestJS services"),w.Ib(),w.Ib(),w.Jb(382,"p"),w.lc(383,"You're now able to send database queries with Prisma Client. If you want to learn more about building queries with Prisma Client, check out the "),w.Jb(384,"a",40),w.lc(385,"API documentation"),w.Ib(),w.lc(386,"."),w.Ib(),w.Jb(387,"p"),w.lc(388,"When setting up your NestJS application, you'll want to abstract away the Prisma Client API for database queries within a service. To get started, you can create a new "),w.Jb(389,"code"),w.lc(390,"PrismaService"),w.Ib(),w.lc(391," that takes care of instantiating "),w.Jb(392,"code"),w.lc(393,"PrismaClient"),w.Ib(),w.lc(394," and connecting to your database."),w.Ib(),w.Jb(395,"p"),w.lc(396,"Inside the "),w.Jb(397,"code"),w.lc(398,"src"),w.Ib(),w.lc(399," directory, create a new file called "),w.Jb(400,"code"),w.lc(401,"prisma.service.ts"),w.Ib(),w.lc(402," and add the following code to it:"),w.Ib(),w.Jb(403,"pre"),w.Jb(404,"code",41),w.lc(405,"\nimport { Injectable, OnModuleInit, OnModuleDestroy } from '@nestjs/common';\nimport { PrismaClient } from '@prisma/client';\n\n@Injectable()\nexport class PrismaService extends PrismaClient\n  implements OnModuleInit, OnModuleDestroy {\n  async onModuleInit() {\n    await this.$connect();\n  }\n\n  async onModuleDestroy() {\n    await this.$disconnect();\n  }\n}\n"),w.Ib(),w.Ib(),w.Jb(406,"p"),w.lc(407,"Next, you can write services that you can use to make database calls for the "),w.Jb(408,"code"),w.lc(409,"User"),w.Ib(),w.lc(410," and "),w.Jb(411,"code"),w.lc(412,"Post"),w.Ib(),w.lc(413," models from your Prisma schema."),w.Ib(),w.Jb(414,"p"),w.lc(415,"Still inside the "),w.Jb(416,"code"),w.lc(417,"src"),w.Ib(),w.lc(418," directory, create a new file called "),w.Jb(419,"code"),w.lc(420,"user.service.ts"),w.Ib(),w.lc(421," and add the following code to it:"),w.Ib(),w.Jb(422,"pre"),w.Jb(423,"code",41),w.lc(424,"\nimport { Injectable } from '@nestjs/common';\nimport { PrismaService } from './prisma.service';\nimport {\n  User,\n  Prisma\n} from '@prisma/client';\n\n@Injectable()\nexport class UserService {\n  constructor(private prisma: PrismaService) {}\n\n  async user(userWhereUniqueInput: Prisma.UserWhereUniqueInput): Promise<User | null> {\n    return this.prisma.user.findUnique({\n      where: userWhereUniqueInput,\n    });\n  }\n\n  async users(params: {\n    skip?: number;\n    take?: number;\n    cursor?: Prisma.UserWhereUniqueInput;\n    where?: Prisma.UserWhereInput;\n    orderBy?: Prisma.UserOrderByInput;\n  }): Promise<User[]> {\n    const { skip, take, cursor, where, orderBy } = params;\n    return this.prisma.user.findMany({\n      skip,\n      take,\n      cursor,\n      where,\n      orderBy,\n    });\n  }\n\n  async createUser(data: Prisma.UserCreateInput): Promise<User> {\n    return this.prisma.user.create({\n      data,\n    });\n  }\n\n  async updateUser(params: {\n    where: Prisma.UserWhereUniqueInput;\n    data: Prisma.UserUpdateInput;\n  }): Promise<User> {\n    const { where, data } = params;\n    return this.prisma.user.update({\n      data,\n      where,\n    });\n  }\n\n  async deleteUser(where: Prisma.UserWhereUniqueInput): Promise<User> {\n    return this.prisma.user.delete({\n      where,\n    });\n  }\n}\n"),w.Ib(),w.Ib(),w.Jb(425,"p"),w.lc(426,"Notice how you're using Prisma Client's generated types to ensure that the methods that are exposed by your service are properly typed. You therefore save the boilerplate of typing your models and creating additional interface or DTO files."),w.Ib(),w.Jb(427,"p"),w.lc(428,"Now do the same for the "),w.Jb(429,"code"),w.lc(430,"Post"),w.Ib(),w.lc(431," model."),w.Ib(),w.Jb(432,"p"),w.lc(433,"Still inside the "),w.Jb(434,"code"),w.lc(435,"src"),w.Ib(),w.lc(436," directory, create a new file called "),w.Jb(437,"code"),w.lc(438,"post.service.ts"),w.Ib(),w.lc(439," and add the following code to it:"),w.Ib(),w.Jb(440,"pre"),w.Jb(441,"code",41),w.lc(442,"\nimport { Injectable } from '@nestjs/common';\nimport { PrismaService } from './prisma.service';\nimport {\n  Post,\n  Prisma,\n} from '@prisma/client';\n\n@Injectable()\nexport class PostService {\n  constructor(private prisma: PrismaService) {}\n\n  async post(postWhereUniqueInput: Prisma.PostWhereUniqueInput): Promise<Post | null> {\n    return this.prisma.post.findUnique({\n      where: postWhereUniqueInput,\n    });\n  }\n\n  async posts(params: {\n    skip?: number;\n    take?: number;\n    cursor?: Prisma.PostWhereUniqueInput;\n    where?: Prisma.PostWhereInput;\n    orderBy?: Prisma.PostOrderByInput;\n  }): Promise<Post[]> {\n    const { skip, take, cursor, where, orderBy } = params;\n    return this.prisma.post.findMany({\n      skip,\n      take,\n      cursor,\n      where,\n      orderBy,\n    });\n  }\n\n  async createPost(data: Prisma.PostCreateInput): Promise<Post> {\n    return this.prisma.post.create({\n      data,\n    });\n  }\n\n  async updatePost(params: {\n    where: Prisma.PostWhereUniqueInput;\n    data: Prisma.PostUpdateInput;\n  }): Promise<Post> {\n    const { data, where } = params;\n    return this.prisma.post.update({\n      data,\n      where,\n    });\n  }\n\n  async deletePost(where: Prisma.PostWhereUniqueInput): Promise<Post> {\n    return this.prisma.post.delete({\n      where,\n    });\n  }\n}\n"),w.Ib(),w.Ib(),w.Jb(443,"p"),w.lc(444,"Your "),w.Jb(445,"code"),w.lc(446,"UserService"),w.Ib(),w.lc(447," and "),w.Jb(448,"code"),w.lc(449,"PostService"),w.Ib(),w.lc(450," currently wrap the CRUD queries that are available in Prisma Client. In a real world application, the service would also be the place to add business logic to your application. For example, you could have a method called "),w.Jb(451,"code"),w.lc(452,"updatePassword"),w.Ib(),w.lc(453," inside the "),w.Jb(454,"code"),w.lc(455,"UserService"),w.Ib(),w.lc(456," that would be responsible for updating the password of a user."),w.Ib(),w.Jb(457,"h5",42),w.lc(458,"Implement your REST API routes in the main app controller"),w.Ib(),w.Jb(459,"p"),w.lc(460,"Finally, you'll use the services you created in the previous sections to implement the different routes of your app. For the purpose of this guide, you'll put all your routes into the already existing "),w.Jb(461,"code"),w.lc(462,"AppController"),w.Ib(),w.lc(463," class."),w.Ib(),w.Jb(464,"p"),w.lc(465,"Replace the contents of the "),w.Jb(466,"code"),w.lc(467,"app.controller.ts"),w.Ib(),w.lc(468," file with the following code:"),w.Ib(),w.Jb(469,"pre"),w.Jb(470,"code",41),w.lc(471,"\nimport {\n  Controller,\n  Get,\n  Param,\n  Post,\n  Body,\n  Put,\n  Delete,\n} from '@nestjs/common';\nimport { UserService } from './user.service';\nimport { PostService } from './post.service';\nimport { User as UserModel, Post as PostModel } from '@prisma/client';\n\n@Controller()\nexport class AppController {\n  constructor(\n    private readonly userService: UserService,\n    private readonly postService: PostService,\n  ) {}\n\n  @Get('post/:id')\n  async getPostById(@Param('id') id: string): Promise<PostModel> {\n    return this.postService.post({ id: Number(id) });\n  }\n\n  @Get('feed')\n  async getPublishedPosts(): Promise<PostModel[]> {\n    return this.postService.posts({\n      where: { published: true },\n    });\n  }\n\n  @Get('filtered-posts/:searchString')\n  async getFilteredPosts(\n    @Param('searchString') searchString: string,\n  ): Promise<PostModel[]> {\n    return this.postService.posts({\n      where: {\n        OR: [\n          {\n            title: { contains: searchString },\n          },\n          {\n            content: { contains: searchString },\n          },\n        ],\n      },\n    });\n  }\n\n  @Post('post')\n  async createDraft(\n    @Body() postData: { title: string; content?: string; authorEmail: string },\n  ): Promise<PostModel> {\n    const { title, content, authorEmail } = postData;\n    return this.postService.createPost({\n      title,\n      content,\n      author: {\n        connect: { email: authorEmail },\n      },\n    });\n  }\n\n  @Post('user')\n  async signupUser(\n    @Body() userData: { name?: string; email: string },\n  ): Promise<UserModel> {\n    return this.userService.createUser(userData);\n  }\n\n  @Put('publish/:id')\n  async publishPost(@Param('id') id: string): Promise<PostModel> {\n    return this.postService.updatePost({\n      where: { id: Number(id) },\n      data: { published: true },\n    });\n  }\n\n  @Delete('post/:id')\n  async deletePost(@Param('id') id: string): Promise<PostModel> {\n    return this.postService.deletePost({ id: Number(id) });\n  }\n}\n"),w.Ib(),w.Ib(),w.Jb(472,"p"),w.lc(473,"This controller implements the following routes:"),w.Ib(),w.Jb(474,"h6",43),w.Jb(475,"code"),w.lc(476,"GET"),w.Ib(),w.Ib(),w.Jb(477,"ul"),w.Jb(478,"li"),w.Jb(479,"code"),w.lc(480,"/post/:id"),w.Ib(),w.lc(481,": Fetch a single post by its "),w.Jb(482,"code"),w.lc(483,"id"),w.Ib(),w.Ib(),w.Jb(484,"li"),w.Jb(485,"code"),w.lc(486,"/feed"),w.Ib(),w.lc(487,": Fetch all "),w.Jb(488,"em"),w.lc(489,"published"),w.Ib(),w.lc(490," posts"),w.Ib(),w.Jb(491,"li"),w.Jb(492,"code"),w.lc(493,"/filter-posts/:searchString"),w.Ib(),w.lc(494,": Filter posts by "),w.Jb(495,"code"),w.lc(496,"title"),w.Ib(),w.lc(497," or "),w.Jb(498,"code"),w.lc(499,"content"),w.Ib(),w.Ib(),w.Ib(),w.Jb(500,"h6",44),w.Jb(501,"code"),w.lc(502,"POST"),w.Ib(),w.Ib(),w.Jb(503,"ul"),w.Jb(504,"li"),w.Jb(505,"code"),w.lc(506,"/post"),w.Ib(),w.lc(507,": Create a new post"),w.Jb(508,"ul"),w.Jb(509,"li"),w.lc(510,"Body:"),w.Jb(511,"ul"),w.Jb(512,"li"),w.Jb(513,"code"),w.lc(514,"title: String"),w.Ib(),w.lc(515," (required): The title of the post"),w.Ib(),w.Jb(516,"li"),w.Jb(517,"code"),w.lc(518,"content: String"),w.Ib(),w.lc(519," (optional): The content of the post"),w.Ib(),w.Jb(520,"li"),w.Jb(521,"code"),w.lc(522,"authorEmail: String"),w.Ib(),w.lc(523," (required): The email of the user that creates the post"),w.Ib(),w.Ib(),w.Ib(),w.Ib(),w.Ib(),w.Jb(524,"li"),w.Jb(525,"code"),w.lc(526,"/user"),w.Ib(),w.lc(527,": Create a new user"),w.Jb(528,"ul"),w.Jb(529,"li"),w.lc(530,"Body:"),w.Jb(531,"ul"),w.Jb(532,"li"),w.Jb(533,"code"),w.lc(534,"email: String"),w.Ib(),w.lc(535," (required): The email address of the user"),w.Ib(),w.Jb(536,"li"),w.Jb(537,"code"),w.lc(538,"name: String"),w.Ib(),w.lc(539," (optional): The name of the user"),w.Ib(),w.Ib(),w.Ib(),w.Ib(),w.Ib(),w.Ib(),w.Jb(540,"h6",45),w.Jb(541,"code"),w.lc(542,"PUT"),w.Ib(),w.Ib(),w.Jb(543,"ul");w.Jb(544,"li"),w.Jb(545,"code"),w.lc(546,"/publish/:id"),w.Ib(),w.lc(547,": Publish a post by its "),w.Jb(548,"code"),w.lc(549,"id"),w.Ib(),w.Ib(),w.Ib(),w.Jb(550,"h6",46),w.Jb(551,"code"),w.lc(552,"DELETE"),w.Ib(),w.Ib(),w.Jb(553,"ul"),w.Jb(554,"li"),w.Jb(555,"code"),w.lc(556,"/post/:id"),w.Ib(),w.lc(557,": Delete a post by its "),w.Jb(558,"code"),w.lc(559,"id"),w.Ib(),w.Ib(),w.Ib(),w.Jb(560,"h4",47),w.Jb(561,"span"),w.lc(562,"Summary"),w.Ib(),w.Ib(),w.Jb(563,"p"),w.lc(564,"In this recipe, you learned how to use Prisma along with NestJS to implement a REST API. The controller that implements the routes of the API is calling a "),w.Jb(565,"code"),w.lc(566,"PrismaService"),w.Ib(),w.lc(567," which in turn uses Prisma Client to send queries to a database to fulfill the data needs of incoming requests."),w.Ib(),w.Jb(568,"p"),w.lc(569,"If you want to learn more about using NestJS with Prisma, be sure to check out the following resources:"),w.Ib(),w.Jb(570,"ul"),w.Jb(571,"li"),w.Jb(572,"a",48),w.lc(573,"NestJS & Prisma"),w.Ib(),w.Ib(),w.Jb(574,"li"),w.Jb(575,"a",18),w.lc(576,"Ready-to-run example projects for REST & GraphQL"),w.Ib(),w.Ib(),w.Jb(577,"li"),w.Jb(578,"a",49),w.lc(579,"Production-ready starter kit"),w.Ib(),w.Ib(),w.Jb(580,"li"),w.Jb(581,"a",50),w.lc(582,"Video: Accessing Databases using NestJS with Prisma (5min)"),w.Ib(),w.lc(583," by "),w.Jb(584,"a",51),w.lc(585,"Marc Stammerjohann"),w.Ib(),w.Ib(),w.Ib(),w.Ib()}},directives:[v.a],encapsulation:2,changeDetection:0}),d),q=w.Lb(R),O=((p=function(n){t(c,n);var a=o(c);function c(){return e(this,c),a.apply(this,arguments)}return c}(y.a)).\u0275fac=function(e){return U(e||p)},p.\u0275cmp=w.Ab({type:p,selectors:[["app-serve-static"]],features:[w.ub],decls:80,vars:0,consts:[[1,"content"],["contentReference",""],[1,"github-links"],["href","https://github.com/nestjs/docs.nestjs.com/edit/master/content/recipes/serve-static.md","aria-label","Suggest Edits","title","Suggest Edits"],[1,"fas","fa-edit"],["id","serve-static"],["rel","nofollow","target","_blank","href","https://www.npmjs.com/package/@nestjs/serve-static"],["appAnchor","","id","installation"],[1,"language-bash"],["appAnchor","","id","bootstrap"],[1,"language-typescript"],["appAnchor","","id","configuration"],["rel","nofollow","target","_blank","href","https://github.com/nestjs/serve-static"],["rel","nofollow","target","_blank","href","https://github.com/nestjs/serve-static/blob/master/lib/interfaces/serve-static-options.interface.ts"],[1,"warning"],["appAnchor","","id","example"],["rel","nofollow","target","_blank","href","https://github.com/nestjs/nest/tree/master/sample/24-serve-static"]],template:function(e,t){1&e&&(w.Jb(0,"div",0,1),w.Jb(2,"div",2),w.Jb(3,"a",3),w.Hb(4,"i",4),w.Ib(),w.Ib(),w.Jb(5,"h3",5),w.lc(6,"Serve Static"),w.Ib(),w.Jb(7,"p"),w.lc(8,"In order to serve static content like a Single Page Application (SPA) we can use the "),w.Jb(9,"code"),w.lc(10,"ServeStaticModule"),w.Ib(),w.lc(11," from the "),w.Jb(12,"a",6),w.Jb(13,"code"),w.lc(14,"@nestjs/serve-static"),w.Ib(),w.Ib(),w.lc(15," package."),w.Ib(),w.Jb(16,"h4",7),w.Jb(17,"span"),w.lc(18,"Installation"),w.Ib(),w.Ib(),w.Jb(19,"p"),w.lc(20,"First we need to install the required package:"),w.Ib(),w.Jb(21,"pre"),w.Jb(22,"code",8),w.lc(23,"\n$ npm install --save @nestjs/serve-static\n"),w.Ib(),w.Ib(),w.Jb(24,"h4",9),w.Jb(25,"span"),w.lc(26,"Bootstrap"),w.Ib(),w.Ib(),w.Jb(27,"p"),w.lc(28,"Once the installation process is done, we can import the "),w.Jb(29,"code"),w.lc(30,"ServeStaticModule"),w.Ib(),w.lc(31," into the root "),w.Jb(32,"code"),w.lc(33,"AppModule"),w.Ib(),w.lc(34," and configure it by passing in a configuration object to the "),w.Jb(35,"code"),w.lc(36,"forRoot()"),w.Ib(),w.lc(37," method."),w.Ib(),w.Jb(38,"pre"),w.Jb(39,"code",10),w.lc(40,"\nimport { Module } from '@nestjs/common';\nimport { AppController } from './app.controller';\nimport { AppService } from './app.service';\nimport { ServeStaticModule } from '@nestjs/serve-static';\nimport { join } from 'path';\n\n@Module({\n  imports: [\n    ServeStaticModule.forRoot({\n      rootPath: join(__dirname, '..', 'client'),\n    }),\n  ],\n  controllers: [AppController],\n  providers: [AppService],\n})\nexport class AppModule {}\n"),w.Ib(),w.Ib(),w.Jb(41,"p"),w.lc(42,"With this in place, build the static website and place its content in the location specified by the "),w.Jb(43,"code"),w.lc(44,"rootPath"),w.Ib(),w.lc(45," property."),w.Ib(),w.Jb(46,"h4",11),w.Jb(47,"span"),w.lc(48,"Configuration"),w.Ib(),w.Ib(),w.Jb(49,"p"),w.Jb(50,"a",12),w.lc(51,"ServeStaticModule"),w.Ib(),w.lc(52," can be configured with a variety of options to customize its behavior.\nYou can set the path to render your static app, specify excluded paths, enable or disable setting Cache-Control response header, etc. See the full list of options "),w.Jb(53,"a",13),w.lc(54,"here"),w.Ib(),w.lc(55,"."),w.Ib(),w.Jb(56,"blockquote",14),w.Jb(57,"strong"),w.lc(58,"Notice"),w.Ib(),w.lc(59," The default "),w.Jb(60,"code"),w.lc(61,"renderPath"),w.Ib(),w.lc(62," of the Static App is "),w.Jb(63,"code"),w.lc(64,"*"),w.Ib(),w.lc(65,' (all paths), and the module will send "index.html" files in response.\nIt lets you create Client-Side routing for your SPA. Paths, specified in your controllers will fallback to the server.\nYou can change this behavior setting '),w.Jb(66,"code"),w.lc(67,"serveRoot"),w.Ib(),w.lc(68,", "),w.Jb(69,"code"),w.lc(70,"renderPath"),w.Ib(),w.lc(71," combining them with other options.\n"),w.Ib(),w.Jb(72,"h4",15),w.Jb(73,"span"),w.lc(74,"Example"),w.Ib(),w.Ib(),w.Jb(75,"p"),w.lc(76,"A working example is available "),w.Jb(77,"a",16),w.lc(78,"here"),w.Ib(),w.lc(79,"."),w.Ib(),w.Ib())},directives:[v.a],encapsulation:2,changeDetection:0}),p),U=w.Lb(O),N=((h=function(n){t(c,n);var a=o(c);function c(){return e(this,c),a.apply(this,arguments)}return c}(y.a)).\u0275fac=function(e){return L(e||h)},h.\u0275cmp=w.Ab({type:h,selectors:[["app-sql-sequelize"]],features:[w.ub],decls:203,vars:20,consts:[[1,"content"],["contentReference",""],[1,"github-links"],["href","https://github.com/nestjs/docs.nestjs.com/edit/master/content/recipes/sql-sequelize.md","aria-label","Suggest Edits","title","Suggest Edits"],[1,"fas","fa-edit"],["id","sql-sequelize"],["id","this-chapter-applies-only-to-typescript"],[1,""],["href","/techniques/database#sequelize-integration"],["rel","nofollow","target","_blank","href","https://github.com/sequelize/sequelize"],["rel","nofollow","target","_blank","href","https://github.com/RobinBuschmann/sequelize-typescript"],["appAnchor","","id","getting-started"],[1,"language-bash"],[1,"filename"],["appb238f95cb7430256c27640e9585ee6a502ab2377",""],[1,"language-typescript"],[1,"info"],["appAnchor","","id","model-injection"],["appe31cd9399524addd660f23cf710e36e16c7d141d",""],["app97c4e4e0468556e8814de4f2df37a4acf1e2e675",""],[1,"warning"],["app61467fa3d715de65c9ab10f53ea2132857fb68bd",""],["app7d3925a165c41a6a691c477491d963f10a44078a",""]],template:function(e,t){if(1&e&&(w.Jb(0,"div",0,1),w.Jb(2,"div",2),w.Jb(3,"a",3),w.Hb(4,"i",4),w.Ib(),w.Ib(),w.Jb(5,"h3",5),w.lc(6,"SQL (Sequelize)"),w.Ib(),w.Jb(7,"h5",6),w.lc(8,"This chapter applies only to TypeScript"),w.Ib(),w.Jb(9,"blockquote",7),w.Jb(10,"strong"),w.lc(11,"Warning"),w.Ib(),w.lc(12," In this article, you'll learn how to create a "),w.Jb(13,"code"),w.lc(14,"DatabaseModule"),w.Ib(),w.lc(15," based on the "),w.Jb(16,"strong"),w.lc(17,"Sequelize"),w.Ib(),w.lc(18," package from scratch using custom components. As a consequence, this technique contains a lot of overhead that you can avoid by using the dedicated, out-of-the-box "),w.Jb(19,"code"),w.lc(20,"@nestjs/sequelize"),w.Ib(),w.lc(21," package. To learn more, see "),w.Jb(22,"a",8),w.lc(23,"here"),w.Ib(),w.lc(24,".\n"),w.Ib(),w.Jb(25,"p"),w.Jb(26,"a",9),w.lc(27,"Sequelize"),w.Ib(),w.lc(28," is a popular Object Relational Mapper (ORM) written in a vanilla JavaScript, but there is a "),w.Jb(29,"a",10),w.lc(30,"sequelize-typescript"),w.Ib(),w.lc(31," TypeScript wrapper which provides a set of decorators and other extras for the base sequelize."),w.Ib(),w.Jb(32,"h4",11),w.Jb(33,"span"),w.lc(34,"Getting started"),w.Ib(),w.Ib(),w.Jb(35,"p"),w.lc(36,"To start the adventure with this library we have to install the following dependencies:"),w.Ib(),w.Jb(37,"pre"),w.Jb(38,"code",12),w.lc(39,"\n$ npm install --save sequelize sequelize-typescript mysql2\n$ npm install --save-dev @types/sequelize\n"),w.Ib(),w.Ib(),w.Jb(40,"p"),w.lc(41,"The first step we need to do is create a "),w.Jb(42,"strong"),w.lc(43,"Sequelize"),w.Ib(),w.lc(44," instance with an options object passed into the constructor. Also, we need to add all models (the alternative is to use "),w.Jb(45,"code"),w.lc(46,"modelPaths"),w.Ib(),w.lc(47," property) and "),w.Jb(48,"code"),w.lc(49,"sync()"),w.Ib(),w.lc(50," our database tables."),w.Ib(),w.Jb(51,"span",13),w.lc(52),w.Vb(53,"extension"),w.Hb(54,"app-tabs",null,14),w.Ib(),w.Jb(56,"pre"),w.Jb(57,"code",15),w.lc(58,"\nimport { Sequelize } from 'sequelize-typescript';\nimport { Cat } from '../cats/cat.entity';\n\nexport const databaseProviders = [\n  {\n    provide: 'SEQUELIZE',\n    useFactory: async () => {\n      const sequelize = new Sequelize({\n        dialect: 'mysql',\n        host: 'localhost',\n        port: 3306,\n        username: 'root',\n        password: 'password',\n        database: 'nest',\n      });\n      sequelize.addModels([Cat]);\n      await sequelize.sync();\n      return sequelize;\n    },\n  },\n];\n"),w.Ib(),w.Ib(),w.Jb(59,"blockquote",16),w.Jb(60,"strong"),w.lc(61,"Hint"),w.Ib(),w.lc(62," Following best practices, we declared the custom provider in the separated file which has a "),w.Jb(63,"code"),w.lc(64,"*.providers.ts"),w.Ib(),w.lc(65," suffix.\n"),w.Ib(),w.Jb(66,"p"),w.lc(67,"Then, we need to export these providers to make them "),w.Jb(68,"strong"),w.lc(69,"accessible"),w.Ib(),w.lc(70," for the rest part of the application."),w.Ib(),w.Jb(71,"pre"),w.Jb(72,"code",15),w.lc(73,"\nimport { Module } from '@nestjs/common';\nimport { databaseProviders } from './database.providers';\n\n@Module({\n  providers: [...databaseProviders],\n  exports: [...databaseProviders],\n})\nexport class DatabaseModule {}\n"),w.Ib(),w.Ib(),w.Jb(74,"p"),w.lc(75,"Now we can inject the "),w.Jb(76,"code"),w.lc(77,"Sequelize"),w.Ib(),w.lc(78," object using "),w.Jb(79,"code"),w.lc(80,"@Inject()"),w.Ib(),w.lc(81," decorator. Each class that would depend on the "),w.Jb(82,"code"),w.lc(83,"Sequelize"),w.Ib(),w.lc(84," async provider will wait until a "),w.Jb(85,"code"),w.lc(86,"Promise"),w.Ib(),w.lc(87," is resolved."),w.Ib(),w.Jb(88,"h4",17),w.Jb(89,"span"),w.lc(90,"Model injection"),w.Ib(),w.Ib(),w.Jb(91,"p"),w.lc(92,"In "),w.Jb(93,"a",9),w.lc(94,"Sequelize"),w.Ib(),w.lc(95," the "),w.Jb(96,"strong"),w.lc(97,"Model"),w.Ib(),w.lc(98," defines a table in the database. Instances of this class represent a database row. Firstly, we need at least one entity:"),w.Ib(),w.Jb(99,"span",13),w.lc(100),w.Vb(101,"extension"),w.Hb(102,"app-tabs",null,18),w.Ib(),w.Jb(104,"pre"),w.Jb(105,"code",15),w.lc(106,"\nimport { Table, Column, Model } from 'sequelize-typescript';\n\n@Table\nexport class Cat extends Model<Cat> {\n  @Column\n  name: string;\n\n  @Column\n  age: number;\n\n  @Column\n  breed: string;\n}\n"),w.Ib(),w.Ib(),w.Jb(107,"p"),w.lc(108,"The "),w.Jb(109,"code"),w.lc(110,"Cat"),w.Ib(),w.lc(111," entity belongs to the "),w.Jb(112,"code"),w.lc(113,"cats"),w.Ib(),w.lc(114," directory. This directory represents the "),w.Jb(115,"code"),w.lc(116,"CatsModule"),w.Ib(),w.lc(117,". Now it's time to create a "),w.Jb(118,"strong"),w.lc(119,"Repository"),w.Ib(),w.lc(120," provider:"),w.Ib(),w.Jb(121,"span",13),w.lc(122),w.Vb(123,"extension"),w.Hb(124,"app-tabs",null,19),w.Ib(),w.Jb(126,"pre"),w.Jb(127,"code",15),w.lc(128,"\nimport { Cat } from './cat.entity';\n\nexport const catsProviders = [\n  {\n    provide: 'CATS_REPOSITORY',\n    useValue: Cat,\n  },\n];\n"),w.Ib(),w.Ib(),w.Jb(129,"blockquote",20),w.Jb(130,"strong"),w.lc(131,"Warning"),w.Ib(),w.lc(132," In the real-world applications you should avoid "),w.Jb(133,"strong"),w.lc(134,"magic strings"),w.Ib(),w.lc(135,". Both "),w.Jb(136,"code"),w.lc(137,"CATS_REPOSITORY"),w.Ib(),w.lc(138," and "),w.Jb(139,"code"),w.lc(140,"SEQUELIZE"),w.Ib(),w.lc(141," should be kept in the separated "),w.Jb(142,"code"),w.lc(143,"constants.ts"),w.Ib(),w.lc(144," file.\n"),w.Ib(),w.Jb(145,"p"),w.lc(146,"In Sequelize, we use static methods to manipulate the data, and thus we created an "),w.Jb(147,"strong"),w.lc(148,"alias"),w.Ib(),w.lc(149," here."),w.Ib(),w.Jb(150,"p"),w.lc(151,"Now we can inject the "),w.Jb(152,"code"),w.lc(153,"CATS_REPOSITORY"),w.Ib(),w.lc(154," to the "),w.Jb(155,"code"),w.lc(156,"CatsService"),w.Ib(),w.lc(157," using the "),w.Jb(158,"code"),w.lc(159,"@Inject()"),w.Ib(),w.lc(160," decorator:"),w.Ib(),w.Jb(161,"span",13),w.lc(162),w.Vb(163,"extension"),w.Hb(164,"app-tabs",null,21),w.Ib(),w.Jb(166,"pre"),w.Jb(167,"code",15),w.lc(168,"\nimport { Injectable, Inject } from '@nestjs/common';\nimport { CreateCatDto } from './dto/create-cat.dto';\nimport { Cat } from './cat.entity';\n\n@Injectable()\nexport class CatsService {\n  constructor(\n    @Inject('CATS_REPOSITORY') private catsRepository: typeof Cat) {}\n\n  async findAll(): Promise<Cat[]> {\n    return this.catsRepository.findAll<Cat>();\n  }\n}\n"),w.Ib(),w.Ib(),w.Jb(169,"p"),w.lc(170,"The database connection is "),w.Jb(171,"strong"),w.lc(172,"asynchronous"),w.Ib(),w.lc(173,", but Nest makes this process completely invisible for the end-user. The "),w.Jb(174,"code"),w.lc(175,"CATS_REPOSITORY"),w.Ib(),w.lc(176," provider is waiting for the db connection, and the "),w.Jb(177,"code"),w.lc(178,"CatsService"),w.Ib(),w.lc(179," is delayed until repository is ready to use. The entire application can start when each class is instantiated."),w.Ib(),w.Jb(180,"p"),w.lc(181,"Here is a final "),w.Jb(182,"code"),w.lc(183,"CatsModule"),w.Ib(),w.lc(184,":"),w.Ib(),w.Jb(185,"span",13),w.lc(186),w.Vb(187,"extension"),w.Hb(188,"app-tabs",null,22),w.Ib(),w.Jb(190,"pre"),w.Jb(191,"code",15),w.lc(192,"\nimport { Module } from '@nestjs/common';\nimport { CatsController } from './cats.controller';\nimport { CatsService } from './cats.service';\nimport { catsProviders } from './cats.providers';\nimport { DatabaseModule } from '../database/database.module';\n\n@Module({\n  imports: [DatabaseModule],\n  controllers: [CatsController],\n  providers: [\n    CatsService,\n    ...catsProviders,\n  ],\n})\nexport class CatsModule {}\n"),w.Ib(),w.Ib(),w.Jb(193,"blockquote",16),w.Jb(194,"strong"),w.lc(195,"Hint"),w.Ib(),w.lc(196," Do not forget to import the "),w.Jb(197,"code"),w.lc(198,"CatsModule"),w.Ib(),w.lc(199," into the root "),w.Jb(200,"code"),w.lc(201,"ApplicationModule"),w.Ib(),w.lc(202,".\n"),w.Ib(),w.Ib()),2&e){var n=w.ec(55),o=w.ec(103),a=w.ec(125),c=w.ec(165),s=w.ec(189);w.wb(52),w.nc(" ",w.Wb(53,5,"database.providers",n.isJsActive),"\n"),w.wb(48),w.nc(" ",w.Wb(101,8,"cat.entity",o.isJsActive),"\n"),w.wb(22),w.nc(" ",w.Wb(123,11,"cats.providers",a.isJsActive),"\n"),w.wb(40),w.nc(" ",w.Wb(163,14,"cats.service",c.isJsActive),"\n"),w.wb(24),w.nc(" ",w.Wb(187,17,"cats.module",s.isJsActive),"\n")}},directives:[v.a,k.a],pipes:[C.a],encapsulation:2,changeDetection:0}),h),L=w.Lb(N),_=((u=function(n){t(c,n);var a=o(c);function c(){return e(this,c),a.apply(this,arguments)}return c}(y.a)).\u0275fac=function(e){return W(e||u)},u.\u0275cmp=w.Ab({type:u,selectors:[["app-sql-typeorm"]],features:[w.ub],decls:215,vars:24,consts:[[1,"content"],["contentReference",""],[1,"github-links"],["href","https://github.com/nestjs/docs.nestjs.com/edit/master/content/recipes/sql-typeorm.md","aria-label","Suggest Edits","title","Suggest Edits"],[1,"fas","fa-edit"],["id","sql-typeorm"],["id","this-chapter-applies-only-to-typescript"],[1,""],["routerLink","/techniques/sql"],["rel","nofollow","target","_blank","href","https://github.com/typeorm/typeorm"],["appAnchor","","id","getting-started"],[1,"language-bash"],["routerLink","/fundamentals/async-components"],[1,"filename"],["app0af72279187ea446a6d74bcbb8a775d51ff9b2db",""],[1,"language-typescript"],[1,"warning"],[1,"info"],["app7699217d81bbce13436901d5d8c578b2584d3b7f",""],["appAnchor","","id","repository-pattern"],["app8e2658782f27a431d40fe7037d571f4ffab85842",""],["appfc9b17ce4fd22dfb6fbd23e7c7e4b6e56b4b634b",""],["appeeb04282a73d78b07f023b521c064a7cce1e48e6",""],["app296c94fa1e531f3f577d06ce64e9a2789a8ed16a",""]],template:function(e,t){if(1&e&&(w.Jb(0,"div",0,1),w.Jb(2,"div",2),w.Jb(3,"a",3),w.Hb(4,"i",4),w.Ib(),w.Ib(),w.Jb(5,"h3",5),w.lc(6,"SQL (TypeORM)"),w.Ib(),w.Jb(7,"h5",6),w.lc(8,"This chapter applies only to TypeScript"),w.Ib(),w.Jb(9,"blockquote",7),w.Jb(10,"strong"),w.lc(11,"Warning"),w.Ib(),w.lc(12," In this article, you'll learn how to create a "),w.Jb(13,"code"),w.lc(14,"DatabaseModule"),w.Ib(),w.lc(15," based on the "),w.Jb(16,"strong"),w.lc(17,"TypeORM"),w.Ib(),w.lc(18," package from scratch using custom providers mechanism. As a consequence, this solution contains a lot of overhead that you can omit using ready to use and available out-of-the-box dedicated "),w.Jb(19,"code"),w.lc(20,"@nestjs/typeorm"),w.Ib(),w.lc(21," package. To learn more, see "),w.Jb(22,"a",8),w.lc(23,"here"),w.Ib(),w.lc(24,".\n"),w.Ib(),w.Jb(25,"p"),w.Jb(26,"a",9),w.lc(27,"TypeORM"),w.Ib(),w.lc(28," is definitely the most mature Object Relational Mapper (ORM) available in the node.js world. Since it's written in TypeScript, it works pretty well with the Nest framework."),w.Ib(),w.Jb(29,"h4",10),w.Jb(30,"span"),w.lc(31,"Getting started"),w.Ib(),w.Ib(),w.Jb(32,"p"),w.lc(33,"To start the adventure with this library we have to install all required dependencies:"),w.Ib(),w.Jb(34,"pre"),w.Jb(35,"code",11),w.lc(36,"\n$ npm install --save typeorm mysql\n"),w.Ib(),w.Ib(),w.Jb(37,"p"),w.lc(38,"The first step we need to do is to establish the connection with our database using "),w.Jb(39,"code"),w.lc(40,"createConnection()"),w.Ib(),w.lc(41," function imported from the "),w.Jb(42,"code"),w.lc(43,"typeorm"),w.Ib(),w.lc(44," package. The "),w.Jb(45,"code"),w.lc(46,"createConnection()"),w.Ib(),w.lc(47," function returns a "),w.Jb(48,"code"),w.lc(49,"Promise"),w.Ib(),w.lc(50,", and therefore we have to create an "),w.Jb(51,"a",12),w.lc(52,"async provider"),w.Ib(),w.lc(53,"."),w.Ib(),w.Jb(54,"span",13),w.lc(55),w.Vb(56,"extension"),w.Hb(57,"app-tabs",null,14),w.Ib(),w.Jb(59,"pre"),w.Jb(60,"code",15),w.lc(61,"\nimport { createConnection } from 'typeorm';\n\nexport const databaseProviders = [\n  {\n    provide: 'DATABASE_CONNECTION',\n    useFactory: async () => await createConnection({\n      type: 'mysql',\n      host: 'localhost',\n      port: 3306,\n      username: 'root',\n      password: 'root',\n      database: 'test',\n      entities: [\n          __dirname + '/../**/*.entity{.ts,.js}',\n      ],\n      synchronize: true,\n    }),\n  },\n];\n"),w.Ib(),w.Ib(),w.Jb(62,"blockquote",16),w.Jb(63,"strong"),w.lc(64,"Warning"),w.Ib(),w.lc(65," Setting "),w.Jb(66,"code"),w.lc(67,"synchronize: true"),w.Ib(),w.lc(68," shouldn't be used in production - otherwise you can lose production data.\n"),w.Ib(),w.Jb(69,"blockquote",17),w.Jb(70,"strong"),w.lc(71,"Hint"),w.Ib(),w.lc(72," Following best practices, we declared the custom provider in the separated file which has a "),w.Jb(73,"code"),w.lc(74,"*.providers.ts"),w.Ib(),w.lc(75," suffix.\n"),w.Ib(),w.Jb(76,"p"),w.lc(77,"Then, we need to export these providers to make them "),w.Jb(78,"strong"),w.lc(79,"accessible"),w.Ib(),w.lc(80," for the rest of the application."),w.Ib(),w.Jb(81,"span",13),w.lc(82),w.Vb(83,"extension"),w.Hb(84,"app-tabs",null,18),w.Ib(),w.Jb(86,"pre"),w.Jb(87,"code",15),w.lc(88,"\nimport { Module } from '@nestjs/common';\nimport { databaseProviders } from './database.providers';\n\n@Module({\n  providers: [...databaseProviders],\n  exports: [...databaseProviders],\n})\nexport class DatabaseModule {}\n"),w.Ib(),w.Ib(),w.Jb(89,"p"),w.lc(90,"Now we can inject the "),w.Jb(91,"code"),w.lc(92,"Connection"),w.Ib(),w.lc(93," object using "),w.Jb(94,"code"),w.lc(95,"@Inject()"),w.Ib(),w.lc(96," decorator. Each class that would depend on the "),w.Jb(97,"code"),w.lc(98,"Connection"),w.Ib(),w.lc(99," async provider will wait until a "),w.Jb(100,"code"),w.lc(101,"Promise"),w.Ib(),w.lc(102," is resolved."),w.Ib(),w.Jb(103,"h4",19),w.Jb(104,"span"),w.lc(105,"Repository pattern"),w.Ib(),w.Ib(),w.Jb(106,"p"),w.lc(107,"The "),w.Jb(108,"a",9),w.lc(109,"TypeORM"),w.Ib(),w.lc(110," supports the repository design pattern, thus each entity has its own Repository. These repositories can be obtained from the database connection."),w.Ib(),w.Jb(111,"p"),w.lc(112,"But firstly, we need at least one entity. We are going to reuse the "),w.Jb(113,"code"),w.lc(114,"Photo"),w.Ib(),w.lc(115," entity from the official documentation."),w.Ib(),w.Jb(116,"span",13),w.lc(117),w.Vb(118,"extension"),w.Hb(119,"app-tabs",null,20),w.Ib(),w.Jb(121,"pre"),w.Jb(122,"code",15),w.lc(123,"\nimport { Entity, Column, PrimaryGeneratedColumn } from 'typeorm';\n\n@Entity()\nexport class Photo {\n  @PrimaryGeneratedColumn()\n  id: number;\n\n  @Column({ length: 500 })\n  name: string;\n\n  @Column('text')\n  description: string;\n\n  @Column()\n  filename: string;\n\n  @Column('int')\n  views: number;\n\n  @Column()\n  isPublished: boolean;\n}\n"),w.Ib(),w.Ib(),w.Jb(124,"p"),w.lc(125,"The "),w.Jb(126,"code"),w.lc(127,"Photo"),w.Ib(),w.lc(128," entity belongs to the "),w.Jb(129,"code"),w.lc(130,"photo"),w.Ib(),w.lc(131," directory. This directory represents the "),w.Jb(132,"code"),w.lc(133,"PhotoModule"),w.Ib(),w.lc(134,". Now, let's create a "),w.Jb(135,"strong"),w.lc(136,"Repository"),w.Ib(),w.lc(137," provider:"),w.Ib(),w.Jb(138,"span",13),w.lc(139),w.Vb(140,"extension"),w.Hb(141,"app-tabs",null,21),w.Ib(),w.Jb(143,"pre"),w.Jb(144,"code",15),w.lc(145,"\nimport { Connection, Repository } from 'typeorm';\nimport { Photo } from './photo.entity';\n\nexport const photoProviders = [\n  {\n    provide: 'PHOTO_REPOSITORY',\n    useFactory: (connection: Connection) => connection.getRepository(Photo),\n    inject: ['DATABASE_CONNECTION'],\n  },\n];\n"),w.Ib(),w.Ib(),w.Jb(146,"blockquote",16),w.Jb(147,"strong"),w.lc(148,"Warning"),w.Ib(),w.lc(149," In the real-world applications you should avoid "),w.Jb(150,"strong"),w.lc(151,"magic strings"),w.Ib(),w.lc(152,". Both "),w.Jb(153,"code"),w.lc(154,"PHOTO_REPOSITORY"),w.Ib(),w.lc(155," and "),w.Jb(156,"code"),w.lc(157,"DATABASE_CONNECTION"),w.Ib(),w.lc(158," should be kept in the separated "),w.Jb(159,"code"),w.lc(160,"constants.ts"),w.Ib(),w.lc(161," file.\n"),w.Ib(),w.Jb(162,"p"),w.lc(163,"Now we can inject the "),w.Jb(164,"code"),w.lc(165,"Repository<Photo>"),w.Ib(),w.lc(166," to the "),w.Jb(167,"code"),w.lc(168,"PhotoService"),w.Ib(),w.lc(169," using the "),w.Jb(170,"code"),w.lc(171,"@Inject()"),w.Ib(),w.lc(172," decorator:"),w.Ib(),w.Jb(173,"span",13),w.lc(174),w.Vb(175,"extension"),w.Hb(176,"app-tabs",null,22),w.Ib(),w.Jb(178,"pre"),w.Jb(179,"code",15),w.lc(180,"\nimport { Injectable, Inject } from '@nestjs/common';\nimport { Repository } from 'typeorm';\nimport { Photo } from './photo.entity';\n\n@Injectable()\nexport class PhotoService {\n  constructor(\n    @Inject('PHOTO_REPOSITORY')\n    private photoRepository: Repository<Photo>,\n  ) {}\n\n  async findAll(): Promise<Photo[]> {\n    return this.photoRepository.find();\n  }\n}\n"),w.Ib(),w.Ib(),w.Jb(181,"p"),w.lc(182,"The database connection is "),w.Jb(183,"strong"),w.lc(184,"asynchronous"),w.Ib(),w.lc(185,", but Nest makes this process completely invisible for the end-user. The "),w.Jb(186,"code"),w.lc(187,"PhotoRepository"),w.Ib(),w.lc(188," is waiting for the db connection, and the "),w.Jb(189,"code"),w.lc(190,"PhotoService"),w.Ib(),w.lc(191," is delayed until repository is ready to use. The entire application can start when each class is instantiated."),w.Ib(),w.Jb(192,"p"),w.lc(193,"Here is a final "),w.Jb(194,"code"),w.lc(195,"PhotoModule"),w.Ib(),w.lc(196,":"),w.Ib(),w.Jb(197,"span",13),w.lc(198),w.Vb(199,"extension"),w.Hb(200,"app-tabs",null,23),w.Ib(),w.Jb(202,"pre"),w.Jb(203,"code",15),w.lc(204,"\nimport { Module } from '@nestjs/common';\nimport { DatabaseModule } from '../database/database.module';\nimport { photoProviders } from './photo.providers';\nimport { PhotoService } from './photo.service';\n\n@Module({\n  imports: [DatabaseModule],\n  providers: [\n    ...photoProviders,\n    PhotoService,\n  ],\n})\nexport class PhotoModule {}\n"),w.Ib(),w.Ib(),w.Jb(205,"blockquote",17),w.Jb(206,"strong"),w.lc(207,"Hint"),w.Ib(),w.lc(208," Do not forget to import the "),w.Jb(209,"code"),w.lc(210,"PhotoModule"),w.Ib(),w.lc(211," into the root "),w.Jb(212,"code"),w.lc(213,"ApplicationModule"),w.Ib(),w.lc(214,".\n"),w.Ib(),w.Ib()),2&e){var n=w.ec(58),o=w.ec(85),a=w.ec(120),c=w.ec(142),s=w.ec(177),r=w.ec(201);w.wb(55),w.nc(" ",w.Wb(56,6,"database.providers",n.isJsActive),"\n"),w.wb(27),w.nc(" ",w.Wb(83,9,"database.module",o.isJsActive),"\n"),w.wb(35),w.nc(" ",w.Wb(118,12,"photo.entity",a.isJsActive),"\n"),w.wb(22),w.nc(" ",w.Wb(140,15,"photo.providers",c.isJsActive),"\n"),w.wb(35),w.nc(" ",w.Wb(175,18,"photo.service",s.isJsActive),"\n"),w.wb(24),w.nc(" ",w.Wb(199,21,"photo.module",r.isJsActive),"\n")}},directives:[g.f,v.a,k.a],pipes:[C.a],encapsulation:2,changeDetection:0}),u),W=w.Lb(_),B=((m=function(n){t(c,n);var a=o(c);function c(){return e(this,c),a.apply(this,arguments)}return c}(y.a)).\u0275fac=function(e){return Q(e||m)},m.\u0275cmp=w.Ab({type:m,selectors:[["app-terminus"]],features:[w.ub],decls:353,vars:44,consts:[[1,"content"],["contentReference",""],[1,"github-links"],["href","https://github.com/nestjs/docs.nestjs.com/edit/master/content/recipes/terminus.md","aria-label","Suggest Edits","title","Suggest Edits"],[1,"fas","fa-edit"],["id","healthchecks-terminus"],["appAnchor","","id","getting-started"],[1,"language-bash"],["appAnchor","","id","setting-up-a-healthcheck"],["rel","nofollow","target","_blank","href","https://github.com/nestjs/terminus"],[1,"filename"],["app89c21804353eee0f0134fd72aac2d34617614280",""],[1,"language-typescript"],["routerLink","/controllers"],["routerLink","cli/overview"],[1,"info"],["href","fundamentals/lifecycle-events#application-shutdown"],["appAnchor","","id","http-healthcheck"],["app4b5e3750d2752d9408cad6118eb31b6142a39af2",""],[1,"language-json"],["appAnchor","","id","typeorm-health-indicator"],["routerLink","/techniques/sql"],["app0b30e9d69a70c555564a74b73e88597f7f0f429c",""],["href","techniques/database#multiple-databases"],["app33f5291600340d371613e133ef1a00684a34bc8d",""],["appAnchor","","id","custom-health-indicator"],["app4d24807a1563eb78b6d59ab006da008661c5309e",""],["appa24a9ff05ee877b5527f2c24f31d9efb4dc20913",""],["app9ce75dd1c78849057ceeda25b3f0cb69ee9e6cf6",""],["appAnchor","","id","examples"],["rel","nofollow","target","_blank","href","https://github.com/nestjs/terminus/tree/master/sample"]],template:function(e,t){if(1&e&&(w.Jb(0,"div",0,1),w.Jb(2,"div",2),w.Jb(3,"a",3),w.Hb(4,"i",4),w.Ib(),w.Ib(),w.Jb(5,"h3",5),w.lc(6,"Healthchecks (Terminus)"),w.Ib(),w.Jb(7,"p"),w.lc(8,"The NestJS "),w.Jb(9,"strong"),w.lc(10,"Terminus"),w.Ib(),w.lc(11," integration supports you with "),w.Jb(12,"strong"),w.lc(13,"readiness / liveness"),w.Ib(),w.lc(14," health checks. Healthchecks are very important when it comes to complex\nbackend setups. In a nutshell, a health check in the realm of web development usually consists of a special address, for example, "),w.Jb(15,"code"),w.lc(16,"https://my-website.com/health/readiness"),w.Ib(),w.lc(17,".\nA service, or a component of your infrastructure (e.g., Kubernetes) checks this address continuously. Depending on the HTTP status code returned from a "),w.Jb(18,"code"),w.lc(19,"GET"),w.Ib(),w.lc(20,' request to this address the service will take action when it receives an "unhealthy" response.\nSince the definition of "healthy" or "unhealthy" varies with the type of service you provide, the NestJS '),w.Jb(21,"strong"),w.lc(22,"Terminus"),w.Ib(),w.lc(23," integration supports you with a\nset of "),w.Jb(24,"strong"),w.lc(25,"health indicators"),w.Ib(),w.lc(26,"."),w.Ib(),w.Jb(27,"p"),w.lc(28,"As an example, if your web server uses MongoDB to store its data, it would be crucial information whether MongoDB is still up and running.\nIn that case, you can make use of the "),w.Jb(29,"code"),w.lc(30,"MongooseHealthIndicator"),w.Ib(),w.lc(31,". If configured correctly - more on that later - your health check address will return\na healthy or unhealthy HTTP status code, depending on whether MongoDB is running."),w.Ib(),w.Jb(32,"h4",6),w.Jb(33,"span"),w.lc(34,"Getting started"),w.Ib(),w.Ib(),w.Jb(35,"p"),w.lc(36,"To get started with "),w.Jb(37,"code"),w.lc(38,"@nestjs/terminus"),w.Ib(),w.lc(39," we need to install the required dependency."),w.Ib(),w.Jb(40,"pre"),w.Jb(41,"code",7),w.lc(42,"\n$ npm install --save @nestjs/terminus\n"),w.Ib(),w.Ib(),w.Jb(43,"h4",8),w.Jb(44,"span"),w.lc(45,"Setting up a Healthcheck"),w.Ib(),w.Ib(),w.Jb(46,"p"),w.lc(47,"A health check represents a summary of "),w.Jb(48,"strong"),w.lc(49,"health indicators"),w.Ib(),w.lc(50,". A health indicator executes a check of a service, whether it is in a healthy or unhealthy state. A health check is positive if all the assigned health indicators are up and running. Because a lot of applications will need similar health indicators, "),w.Jb(51,"a",9),w.lc(52,"@nestjs/terminus"),w.Ib(),w.lc(53," provides a set of predefined indicators, such as:"),w.Ib(),w.Jb(54,"ul"),w.Jb(55,"li"),w.Jb(56,"code"),w.lc(57,"HttpHealthIndicator"),w.Ib(),w.Ib(),w.Jb(58,"li"),w.Jb(59,"code"),w.lc(60,"TypeOrmHealthIndicator"),w.Ib(),w.Ib(),w.Jb(61,"li"),w.Jb(62,"code"),w.lc(63,"MongooseHealthIndicator"),w.Ib(),w.Ib(),w.Jb(64,"li"),w.Jb(65,"code"),w.lc(66,"SequelizeHealthIndicator"),w.Ib(),w.Ib(),w.Jb(67,"li"),w.Jb(68,"code"),w.lc(69,"MicroserviceHealthIndicator"),w.Ib(),w.Ib(),w.Jb(70,"li"),w.Jb(71,"code"),w.lc(72,"GRPCHealthIndicator"),w.Ib(),w.Ib(),w.Jb(73,"li"),w.Jb(74,"code"),w.lc(75,"MemoryHealthIndicator"),w.Ib(),w.Ib(),w.Jb(76,"li"),w.Jb(77,"code"),w.lc(78,"DiskHealthIndicator"),w.Ib(),w.Ib(),w.Ib(),w.Jb(79,"p"),w.lc(80,"To get started with our first health check, we need to import the "),w.Jb(81,"code"),w.lc(82,"TerminusModule"),w.Ib(),w.lc(83," into our "),w.Jb(84,"code"),w.lc(85,"AppModule"),w.Ib(),w.lc(86,"."),w.Ib(),w.Jb(87,"span",10),w.lc(88),w.Vb(89,"extension"),w.Hb(90,"app-tabs",null,11),w.Ib(),w.Jb(92,"pre"),w.Jb(93,"code",12),w.lc(94,"\nimport { Module } from '@nestjs/common';\nimport { TerminusModule } from '@nestjs/terminus';\n\n@Module({\n  imports: [TerminusModule]\n})\nexport class AppModule { }\n"),w.Ib(),w.Ib(),w.Jb(95,"p"),w.lc(96,"Our healthcheck(s) can be executed using a "),w.Jb(97,"a",13),w.lc(98,"controller"),w.Ib(),w.lc(99,", which can be easily setup using the "),w.Jb(100,"a",14),w.lc(101,"NestJS CLI"),w.Ib(),w.lc(102,"."),w.Ib(),w.Jb(103,"pre"),w.Jb(104,"code",7),w.lc(105,"\n$ nest generate controller health\n"),w.Ib(),w.Ib(),w.Jb(106,"blockquote",15),w.Jb(107,"strong"),w.lc(108,"Info"),w.Ib(),w.lc(109," It is highly recommended to enable shutdown hooks in your application. The Terminus integration makes use of this lifecycle event if enabled. Read more about shutdown hooks "),w.Jb(110,"a",16),w.lc(111,"here"),w.Ib(),w.lc(112,".\n"),w.Ib(),w.Jb(113,"h4",17),w.Jb(114,"span"),w.lc(115,"HTTP Healthcheck"),w.Ib(),w.Ib(),w.Jb(116,"p"),w.lc(117,"Once we have installed "),w.Jb(118,"code"),w.lc(119,"@nestjs/terminus"),w.Ib(),w.lc(120,", imported our "),w.Jb(121,"code"),w.lc(122,"TerminusModule"),w.Ib(),w.lc(123," and created a new controller, we are ready to create a health check. "),w.Ib(),w.Jb(124,"span",10),w.lc(125),w.Vb(126,"extension"),w.Hb(127,"app-tabs",null,18),w.Ib(),w.Jb(129,"pre"),w.Jb(130,"code",12),w.lc(131,"\n@Controller('health')\nexport class HealthController {\n  constructor(\n    private health: HealthCheckService,\n    private http: HttpHealthIndicator,\n  ) {}\n\n  @Get()\n  @HealthCheck()\n  check() {\n    return this.health.check([\n      () => this.http.pingCheck('nestjs-docs', 'https://docs.nestjs.com'),\n    ]);\n  }\n}\n"),w.Ib(),w.Ib(),w.Jb(132,"pre"),w.Jb(133,"code",12),w.lc(134,"\n@Controller('health')\n@Dependencies(HealthCheckService, HttpHealthIndicator)\nexport class HealthController {\n  constructor(\n    private health,\n    private http,\n  ) { }\n\n  @Get()\n  @HealthCheck()\n  healthCheck() {\n    return this.health.check([\n      async () => this.http.pingCheck('nestjs-docs', 'https://docs.nestjs.com'),\n    ])\n  }\n}\n"),w.Ib(),w.Ib(),w.Jb(135,"p"),w.lc(136,"Our health check will now send a "),w.Jb(137,"em"),w.lc(138,"GET"),w.Ib(),w.lc(139,"-request to the "),w.Jb(140,"code"),w.lc(141,"https://docs.nestjs.com"),w.Ib(),w.lc(142," address. If\nwe get a healthy response from that address, our route at "),w.Jb(143,"code"),w.lc(144,"http://localhost:3000/health"),w.Ib(),w.lc(145," will return\nthe following object with a 200 status code."),w.Ib(),w.Jb(146,"pre"),w.Jb(147,"code",19),w.lc(148,'\n{\n  "status": "ok",\n  "info": {\n    "nestjs-docs": {\n      "status": "up"\n    }\n  },\n  "error": {},\n  "details": {\n    "nestjs-docs": {\n      "status": "up"\n    }\n  }\n}\n'),w.Ib(),w.Ib(),w.Jb(149,"p"),w.lc(150,"The interface of this response object can be accessed from the "),w.Jb(151,"code"),w.lc(152,"@nestjs/terminus"),w.Ib(),w.lc(153," package with the "),w.Jb(154,"code"),w.lc(155,"HealthCheckResult"),w.Ib(),w.lc(156," interface."),w.Ib(),w.Jb(157,"table"),w.Hb(158,"thead"),w.Jb(159,"tbody"),w.Jb(160,"tr"),w.Jb(161,"td"),w.Jb(162,"code"),w.lc(163,"status"),w.Ib(),w.Ib(),w.Jb(164,"td"),w.lc(165,"If any health indicator failed the status will be "),w.Jb(166,"code"),w.lc(167,"'error'"),w.Ib(),w.lc(168,". If the NestJS app is shutting down but still accepting HTTP requests, the health check will have the "),w.Jb(169,"code"),w.lc(170,"'shutting_down'"),w.Ib(),w.lc(171," status."),w.Ib(),w.Jb(172,"td"),w.Jb(173,"code"),w.lc(174,"'error' | 'ok' | 'shutting_down'"),w.Ib(),w.Ib(),w.Ib(),w.Jb(175,"tr"),w.Jb(176,"td"),w.Jb(177,"code"),w.lc(178,"info"),w.Ib(),w.Ib(),w.Jb(179,"td"),w.lc(180,"Object containing information of each health indicator which is of status "),w.Jb(181,"code"),w.lc(182,"'up'"),w.Ib(),w.lc(183,', or in other words "healthy".'),w.Ib(),w.Jb(184,"td"),w.Jb(185,"code"),w.lc(186,"object"),w.Ib(),w.Ib(),w.Ib(),w.Jb(187,"tr"),w.Jb(188,"td"),w.Jb(189,"code"),w.lc(190,"error"),w.Ib(),w.Ib(),w.Jb(191,"td"),w.lc(192,"Object containing information of each health indicator which is of status "),w.Jb(193,"code"),w.lc(194,"'down'"),w.Ib(),w.lc(195,', or in other words "unhealthy".'),w.Ib(),w.Jb(196,"td"),w.Jb(197,"code"),w.lc(198,"object"),w.Ib(),w.Ib(),w.Ib(),w.Jb(199,"tr"),w.Jb(200,"td"),w.Jb(201,"code"),w.lc(202,"details"),w.Ib(),w.Ib(),w.Jb(203,"td"),w.lc(204,"Object containing all information of each health indicator"),w.Ib(),w.Jb(205,"td"),w.Jb(206,"code"),w.lc(207,"object"),w.Ib(),w.Ib(),w.Ib(),w.Ib(),w.Ib(),w.Jb(208,"h4",20),w.Jb(209,"span"),w.lc(210,"TypeOrm health indicator"),w.Ib(),w.Ib(),w.Jb(211,"p"),w.lc(212,"Terminus offers the capability to add database checks to your health check. In order to get started with this health indicator, you\nshould check out the "),w.Jb(213,"a",21),w.lc(214,"Database chapter"),w.Ib(),w.lc(215," and make sure your database connection within your application is established."),w.Ib(),w.Jb(216,"blockquote",15),w.Jb(217,"strong"),w.lc(218,"Hint"),w.Ib(),w.lc(219," Behind the scenes the "),w.Jb(220,"code"),w.lc(221,"TypeOrmHealthIndicator"),w.Ib(),w.lc(222," simply executes a "),w.Jb(223,"code"),w.lc(224,"SELECT 1"),w.Ib(),w.lc(225,"-SQL command which is often used to verify whether the database still alive. In case you are using an Oracle database it uses "),w.Jb(226,"code"),w.lc(227,"SELECT 1 FROM DUAL"),w.Ib(),w.lc(228,". "),w.Ib(),w.Jb(229,"span",10),w.lc(230),w.Vb(231,"extension"),w.Hb(232,"app-tabs",null,22),w.Ib(),w.Jb(234,"pre"),w.Jb(235,"code",12),w.lc(236,"\n@Controller('health')\nexport class HealthController {\n  constructor(\n    private health: HealthCheckService,\n    private db: TypeOrmHealthIndicator,\n  ) {}\n\n  @Get()\n  @HealthCheck()\n  check() {\n    return this.health.check([\n      () => this.db.pingCheck('database'),\n    ]);\n  }\n}\n"),w.Ib(),w.Ib(),w.Jb(237,"pre"),w.Jb(238,"code",12),w.lc(239,"\n@Controller('health')\n@Dependencies(HealthCheckService, TypeOrmHealthIndicator)\nexport class HealthController {\n  constructor(\n    private health,\n    private db,\n  ) { }\n\n  @Get()\n  @HealthCheck()\n  healthCheck() {\n    return this.health.check([\n      async () => this.db.pingCheck('database'),\n    ])\n  }\n}\n"),w.Ib(),w.Ib(),w.Jb(240,"p"),w.lc(241,"If your database is reachable, you should now see the following JSON-result when requesting "),w.Jb(242,"code"),w.lc(243,"http://localhost:3000"),w.Ib(),w.lc(244," with a "),w.Jb(245,"code"),w.lc(246,"GET"),w.Ib(),w.lc(247," request:"),w.Ib(),w.Jb(248,"pre"),w.Jb(249,"code",19),w.lc(250,'\n{\n  "status": "ok",\n  "info": {\n    "database": {\n      "status": "up"\n    }\n  },\n  "error": {},\n  "details": {\n    "database": {\n      "status": "up"\n    }\n  }\n}\n'),w.Ib(),w.Ib(),w.Jb(251,"p"),w.lc(252,"In case your app uses "),w.Jb(253,"a",23),w.lc(254,"multiple databases"),w.Ib(),w.lc(255,", you need to inject each\nconnection into your "),w.Jb(256,"code"),w.lc(257,"HealthController"),w.Ib(),w.lc(258,". Then, you can simply pass the connection reference to the "),w.Jb(259,"code"),w.lc(260,"TypeOrmHealthIndicator"),w.Ib(),w.lc(261,"."),w.Ib(),w.Jb(262,"span",10),w.lc(263),w.Vb(264,"extension"),w.Hb(265,"app-tabs",null,24),w.Ib(),w.Jb(267,"pre"),w.Jb(268,"code",12),w.lc(269,"\n@Controller('health')\nexport class HealthController {\n  constructor(\n    private health: HealthCheckService,\n    private db: TypeOrmHealthIndicator,\n    @InjectConnection('albumsConnection')\n    private albumsConnection: Connection,\n    @InjectConnection()\n    private defaultConnection: Connection,\n  ) {}\n\n  @Get()\n  @HealthCheck()\n  check() {\n    return this.health.check([\n      () => this.db.pingCheck('albums-database', { connection: this.albumsConnection }),\n      () => this.db.pingCheck('database', { connection: this.defaultConnection }),\n    ]);\n  }\n}\n"),w.Ib(),w.Ib(),w.Jb(270,"h4",25),w.Jb(271,"span"),w.lc(272,"Custom health indicator"),w.Ib(),w.Ib(),w.Jb(273,"p"),w.lc(274,"In some cases, the predefined health indicators provided by "),w.Jb(275,"code"),w.lc(276,"@nestjs/terminus"),w.Ib(),w.lc(277," do not cover all of your health check requirements. In that case, you can set up a custom health indicator according to your needs."),w.Ib(),w.Jb(278,"p"),w.lc(279,"Let's get started by creating a service that will represent our custom indicator. To get a basic understanding of how an indicator is structured, we will create an example "),w.Jb(280,"code"),w.lc(281,"DogHealthIndicator"),w.Ib(),w.lc(282,". This service should have the state "),w.Jb(283,"code"),w.lc(284,"'up'"),w.Ib(),w.lc(285," if every "),w.Jb(286,"code"),w.lc(287,"Dog"),w.Ib(),w.lc(288," object has the type "),w.Jb(289,"code"),w.lc(290,"'goodboy'"),w.Ib(),w.lc(291,". If that condition is not satisfied then it should throw an error."),w.Ib(),w.Jb(292,"span",10),w.lc(293),w.Vb(294,"extension"),w.Hb(295,"app-tabs",null,26),w.Ib(),w.Jb(297,"pre"),w.Jb(298,"code",12),w.lc(299,"\nimport { Injectable } from '@nestjs/common';\nimport { HealthIndicator, HealthIndicatorResult, HealthCheckError } from '@nestjs/terminus';\n\nexport interface Dog {\n  name: string;\n  type: string;\n}\n\n@Injectable()\nexport class DogHealthIndicator extends HealthIndicator {\n  private dogs: Dog[] = [\n    { name: 'Fido', type: 'goodboy' },\n    { name: 'Rex', type: 'badboy' },\n  ];\n\n  async isHealthy(key: string): Promise<HealthIndicatorResult> {\n    const badboys = this.dogs.filter(dog => dog.type === 'badboy');\n    const isHealthy = badboys.length === 0;\n    const result = this.getStatus(key, isHealthy, { badboys: badboys.length });\n\n    if (isHealthy) {\n      return result;\n    }\n    throw new HealthCheckError('Dogcheck failed', result);\n  }\n}\n"),w.Ib(),w.Ib(),w.Jb(300,"pre"),w.Jb(301,"code",12),w.lc(302,"\nimport { Injectable } from '@nestjs/common';\nimport { HealthCheckError } from '@godaddy/terminus';\n\n@Injectable()\nexport class DogHealthIndicator extends HealthIndicator {\n  dogs = [\n    { name: 'Fido', type: 'goodboy' },\n    { name: 'Rex', type: 'badboy' },\n  ];\n\n  async isHealthy(key) {\n    const badboys = this.dogs.filter(dog => dog.type === 'badboy');\n    const isHealthy = badboys.length === 0;\n    const result = this.getStatus(key, isHealthy, { badboys: badboys.length });\n\n    if (isHealthy) {\n      return result;\n    }\n    throw new HealthCheckError('Dogcheck failed', result);\n  }\n}\n"),w.Ib(),w.Ib(),w.Jb(303,"p"),w.lc(304,"The next thing we need to do is register the health indicator as a provider."),w.Ib(),w.Jb(305,"span",10),w.lc(306),w.Vb(307,"extension"),w.Hb(308,"app-tabs",null,27),w.Ib(),w.Jb(310,"pre"),w.Jb(311,"code",12),w.lc(312,"\nimport { Module } from '@nestjs/common';\nimport { TerminusModule } from '@nestjs/terminus';\nimport { DogHealthIndicator } from './dog.health';\n\n@Module({\n  controllers: [HealthController],\n  imports: [TerminusModule],\n  providers: [DogHealthIndicator]\n})\nexport class AppModule { }\n"),w.Ib(),w.Ib(),w.Jb(313,"blockquote",15),w.Jb(314,"strong"),w.lc(315,"Hint"),w.Ib(),w.lc(316," In a real-world application the "),w.Jb(317,"code"),w.lc(318,"DogHealthIndicator"),w.Ib(),w.lc(319," should be provided in a separate module, for example, "),w.Jb(320,"code"),w.lc(321,"DogModule"),w.Ib(),w.lc(322,", which then will be imported by the "),w.Jb(323,"code"),w.lc(324,"AppModule"),w.Ib(),w.lc(325,".\n"),w.Ib(),w.Jb(326,"p"),w.lc(327,"The last required step is to add the now available health indicator in the required health check endpoint. For that, we go back to our "),w.Jb(328,"code"),w.lc(329,"HealthController"),w.Ib(),w.lc(330," and add it to our "),w.Jb(331,"code"),w.lc(332,"check"),w.Ib(),w.lc(333," function."),w.Ib(),w.Jb(334,"span",10),w.lc(335),w.Vb(336,"extension"),w.Hb(337,"app-tabs",null,28),w.Ib(),w.Jb(339,"pre"),w.Jb(340,"code",12),w.lc(341,"\nimport { HealthCheckService } from '@nestjs/terminus';\nimport { Injectable } from '@nestjs/common';\nimport { DogHealthIndicator } from './dog.health';\n\n@Injectable()\nexport class HealthController {\n  constructor(\n    private health: HealthCheckService,\n    private dogHealthIndicator: DogHealthIndicator\n  ) {}\n\n  @Get()\n  @HealthCheck()\n  healthCheck() {\n    return this.health.check([\n      async () => this.dogHealthIndicator.isHealthy('dog'),\n    ])\n  }\n}\n"),w.Ib(),w.Ib(),w.Jb(342,"pre"),w.Jb(343,"code",12),w.lc(344,"\nimport { HealthCheckService } from '@nestjs/terminus';\nimport { Injectable } from '@nestjs/common';\nimport { DogHealthIndicator } from './dog.health';\n\n@Injectable()\n@Dependencies(HealthCheckService, DogHealthIndicator)\nexport class HealthController {\n  constructor(\n    private health,\n    private dogHealthIndicator\n  ) {}\n\n  @Get()\n  @HealthCheck()\n  healthCheck() {\n    return this.health.check([\n      async () => this.dogHealthIndicator.isHealthy('dog'),\n    ])\n  }\n}\n"),w.Ib(),w.Ib(),w.Jb(345,"h4",29),w.Jb(346,"span"),w.lc(347,"Examples"),w.Ib(),w.Ib(),w.Jb(348,"p"),w.lc(349,"Some working examples are available "),w.Jb(350,"a",30),w.lc(351,"here"),w.Ib(),w.lc(352,"."),w.Ib(),w.Ib()),2&e){var n=w.ec(91),o=w.ec(128),a=w.ec(233),c=w.ec(266),s=w.ec(296),r=w.ec(309),l=w.ec(338);w.wb(88),w.nc(" ",w.Wb(89,23,"app.module",n.isJsActive),"\n"),w.wb(37),w.nc(" ",w.Wb(126,26,"health.controller",o.isJsActive),"\n"),w.wb(4),w.yb("hide",o.isJsActive),w.wb(3),w.yb("hide",!o.isJsActive),w.wb(98),w.nc(" ",w.Wb(231,29,"health.controller",a.isJsActive),"\n"),w.wb(4),w.yb("hide",a.isJsActive),w.wb(3),w.yb("hide",!a.isJsActive),w.wb(26),w.nc(" ",w.Wb(264,32,"health.controller",c.isJsActive),"\n"),w.wb(30),w.nc(" ",w.Wb(294,35,"dog.health",s.isJsActive),"\n"),w.wb(4),w.yb("hide",s.isJsActive),w.wb(3),w.yb("hide",!s.isJsActive),w.wb(6),w.nc(" ",w.Wb(307,38,"app.module",r.isJsActive),"\n"),w.wb(29),w.nc(" ",w.Wb(336,41,"health.controller",l.isJsActive),"\n"),w.wb(4),w.yb("hide",l.isJsActive),w.wb(3),w.yb("hide",!l.isJsActive)}},directives:[v.a,k.a,g.f],pipes:[C.a],encapsulation:2,changeDetection:0}),m),Q=w.Lb(B),G=[{path:"sql-typeorm",component:_,data:{title:"SQL (TypeORM)"}},{path:"mongodb",component:D,data:{title:"MongoDB (Mongoose)"}},{path:"sql-sequelize",component:N,data:{title:"SQL (Sequelize)"}},{path:"cqrs",component:S,data:{title:"CQRS"}},{path:"swagger",redirectTo:"/openapi/introduction"},{path:"prisma",component:R,data:{title:"Prisma"}},{path:"terminus",component:B,data:{title:"Health checks (Terminus)"}},{path:"documentation",component:x,data:{title:"Documentation (Compodoc)"}},{path:"crud-utilities",redirectTo:"/recipes/crud-generator"},{path:"crud",redirectTo:"/recipes/crud-generator"},{path:"crud-generator",component:A,data:{title:"CRUD generator"}},{path:"hot-reload",component:j,data:{title:"Hot reload"}},{path:"serve-static",component:O,data:{title:"Serve Static"}}],z=((I=function t(){e(this,t)}).\u0275mod=w.Eb({type:I}),I.\u0275inj=w.Db({factory:function(e){return new(e||I)},imports:[[J.b,f.a,g.g.forChild(G)]]}),I)}}])}();